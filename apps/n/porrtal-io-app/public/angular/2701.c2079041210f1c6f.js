/*
Copyright 2022 Comcast Cable Communications Management, LLC

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at
    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
"use strict";(self.webpackChunka_porrtal_io_app=self.webpackChunka_porrtal_io_app||[]).push([[2701],{12701:(de,R,l)=>{l.r(R),l.d(R,{default:()=>fe});var B=l(15861),n=l(17626),G=(l(29132),l(46160)),D=l(46882),L=l(62208),H=l(99959),Q=l(10699),v=l(32917),J=l(21726),u=l(77712),V=(l(85931),l(90912)),I=l(68653),U=l(76898),X=l(99433),F=l(65234),$=l(44917),w=l(552),k=l(49286),q=l(6647),_=l(30346),ee=l(99555),te=l(13812),re=l(61885),se=l(86810),oe=l(47996),le=l(77275),ne=l(59318),K=l(24263),ie=(l(73281),l(84792)),P=l(58817),c=l(5548),O=l(32442);l(33474),l(17253);const ae={esriGeometryPoint:"points",esriGeometryPolyline:"polylines",esriGeometryPolygon:"polygons"};function Y(e){const r=e.folders||[],o=r.slice(),s=new Map,a=new Map,d=new Map,b=new Map,E=new Map,g={esriGeometryPoint:a,esriGeometryPolyline:d,esriGeometryPolygon:b};(e.featureCollection&&e.featureCollection.layers||[]).forEach(i=>{const C=(0,P.d9)(i);C.featureSet.features=[];const h=i.featureSet.geometryType;s.set(h,C);const N=i.layerDefinition.objectIdField;"esriGeometryPoint"===h?M(a,N,i.featureSet.features):"esriGeometryPolyline"===h?M(d,N,i.featureSet.features):"esriGeometryPolygon"===h&&M(b,N,i.featureSet.features)}),e.groundOverlays&&e.groundOverlays.forEach(i=>{E.set(i.id,i)}),r.forEach(i=>{i.networkLinkIds.forEach(C=>{const h=function ue(e,r,o){const s=function ye(e,r){let o;return r.some(s=>s.id===e&&(o=s,!0)),o}(e,o);return s&&(s.parentFolderId=r,s.networkLink=s),s}(C,i.id,e.networkLinks);h&&o.push(h)})}),o.forEach(i=>{if(i.featureInfos){i.points=(0,P.d9)(s.get("esriGeometryPoint")),i.polylines=(0,P.d9)(s.get("esriGeometryPolyline")),i.polygons=(0,P.d9)(s.get("esriGeometryPolygon")),i.mapImages=[];for(const C of i.featureInfos)switch(C.type){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryPolygon":{const h=g[C.type].get(C.id);h&&i[ae[C.type]].featureSet.features.push(h);break}case"GroundOverlay":{const h=E.get(C.id);h&&i.mapImages.push(h);break}}i.fullExtent=T([i])}});const S=T(o);return{folders:r,sublayers:o,extent:S}}function z(e,r,o,s){const a=K.id&&K.id.findCredential(e);return e=(0,J.fl)(e,{token:a&&a.token}),(0,ie.default)(ne.Z.kmlServiceUrl,{query:{url:e,model:"simple",folders:"",refresh:0!==o||void 0,outSR:JSON.stringify(r)},responseType:"json",signal:s})}function A(e,r,o=null,s=[]){const a=[],d={},b=r.sublayers,E=r.folders.map(g=>g.id);return b.forEach(g=>{const S=new e;if(o?S.read(g,o):S.read(g),s.length&&E.includes(S.id)&&(S.visible=s.includes(S.id)),d[g.id]=S,null!=g.parentFolderId&&-1!==g.parentFolderId){const i=d[g.parentFolderId];i.sublayers||(i.sublayers=[]),i.sublayers.unshift(S)}else a.unshift(S)}),a}function M(e,r,o){o.forEach(s=>{e.set(s.attributes[r],s)})}function T(e){const r=(0,c.Ue)(c.Gv),o=(0,c.Ue)(c.Gv);for(const s of e){if(s.polygons&&s.polygons.featureSet&&s.polygons.featureSet.features)for(const a of s.polygons.featureSet.features)(0,O.Yg)(r,a.geometry),(0,c.TC)(o,r);if(s.polylines&&s.polylines.featureSet&&s.polylines.featureSet.features)for(const a of s.polylines.featureSet.features)(0,O.Yg)(r,a.geometry),(0,c.TC)(o,r);if(s.points&&s.points.featureSet&&s.points.featureSet.features)for(const a of s.points.featureSet.features)(0,O.Yg)(r,a.geometry),(0,c.TC)(o,r);if(s.mapImages)for(const a of s.mapImages)(0,O.Yg)(r,a.extent),(0,c.TC)(o,r)}return(0,c.fS)(o,c.Gv)?null:{xmin:o[0],ymin:o[1],zmin:o[2],xmax:o[3],ymax:o[4],zmax:o[5],spatialReference:F.Z.WGS84}}var x,j=l(2004);let f=x=class extends(re.Z.EventedMixin((0,se.eC)(oe.Z))){constructor(...e){super(...e),this.description=null,this.id=null,this.networkLink=null,this.sublayers=null,this.title=null,this.sourceJSON=null,this.fullExtent=null,this.addHandles([(0,v.on)(()=>this.sublayers,"after-add",({item:r})=>{r.parent=this,r.layer=this.layer},v.Z_),(0,v.on)(()=>this.sublayers,"after-remove",({item:r})=>{r.layer=r.parent=null},v.Z_),(0,v.YP)(()=>this.sublayers,(r,o)=>{if(o)for(const s of o)s.layer=s.parent=null;if(r)for(const s of r)s.parent=this,s.layer=this.layer},v.Z_)])}initialize(){(0,v.N1)(()=>this.networkLink).then(()=>(0,v.N1)(()=>!0===this.visible)).then(()=>this.load())}load(e){if(!this.networkLink||this.networkLink.viewFormat)return;const r=(0,L.pC)(e)?e.signal:null,o=this._fetchService(this._get("networkLink")?.href??"",r).then(s=>{const a=T(s.sublayers);this.fullExtent=j.Z.fromJSON(a),this.sourceJSON=s;const d=(0,V.se)(G.Z.ofType(x),A(x,s));this.sublayers?this.sublayers.addMany(d):this.sublayers=d,this.layer?.emit("sublayer-update"),this.layer&&this.layer.notifyChange("visibleSublayers")});return this.addResolvingPromise(o),Promise.resolve(this)}get visible(){return this._get("visible")}set visible(e){this._get("visible")!==e&&(this._set("visible",e),this.layer&&this.layer.notifyChange("visibleSublayers"))}readVisible(e,r){return!!r.visibility}set layer(e){this._set("layer",e),this.sublayers&&this.sublayers.forEach(r=>r.layer=e)}_fetchService(e,r){return z(e,this.layer.outSpatialReference,this.layer.refreshInterval,r).then(o=>Y(o.data))}};(0,n._)([(0,u.Cb)()],f.prototype,"description",void 0),(0,n._)([(0,u.Cb)()],f.prototype,"id",void 0),(0,n._)([(0,u.Cb)({readOnly:!0,value:null})],f.prototype,"networkLink",void 0),(0,n._)([(0,u.Cb)({json:{write:{allowNull:!0}}})],f.prototype,"parent",void 0),(0,n._)([(0,u.Cb)({type:G.Z.ofType(x),json:{write:{allowNull:!0}}})],f.prototype,"sublayers",void 0),(0,n._)([(0,u.Cb)({value:null,json:{read:{source:"name",reader:e=>(0,le.Cb)(e)}}})],f.prototype,"title",void 0),(0,n._)([(0,u.Cb)({value:!0})],f.prototype,"visible",null),(0,n._)([(0,I.r)("visible",["visibility"])],f.prototype,"readVisible",null),(0,n._)([(0,u.Cb)()],f.prototype,"sourceJSON",void 0),(0,n._)([(0,u.Cb)({value:null})],f.prototype,"layer",null),(0,n._)([(0,u.Cb)({type:j.Z})],f.prototype,"fullExtent",void 0),f=x=(0,n._)([(0,U.j)("esri.layers.support.KMLSublayer")],f);const W=f,pe=["kml","xml"];let p=class extends((0,w.h)((0,_.Q)((0,ee.M)((0,k.q)((0,q.I)((0,H.R)($.Z))))))){constructor(...e){super(...e),this._visibleFolders=[],this.allSublayers=new D.Z({getCollections:()=>[this.sublayers],getChildrenFunction:r=>r.sublayers}),this.outSpatialReference=F.Z.WGS84,this.path=null,this.legendEnabled=!1,this.operationalLayerType="KML",this.sublayers=null,this.type="kml",this.url=null}initialize(){this.addHandles([(0,v.YP)(()=>this.sublayers,(e,r)=>{r&&r.forEach(o=>{o.parent=null,o.layer=null}),e&&e.forEach(o=>{o.parent=this,o.layer=this})},v.Z_),this.on("sublayer-update",()=>this.notifyChange("fullExtent"))])}normalizeCtorArgs(e,r){return"string"==typeof e?{url:e,...r}:e}readSublayersFromItemOrWebMap(e,r){this._visibleFolders=r.visibleFolders}readSublayers(e,r,o){return A(W,r,o,this._visibleFolders)}writeSublayers(e,r){const o=[],s=e.toArray();for(;s.length;){const a=s[0];a.networkLink||(a.visible&&o.push(a.id),a.sublayers&&s.push(...a.sublayers.toArray())),s.shift()}r.visibleFolders=o}get title(){const e=this._get("title");return e&&"defaults"!==this.originOf("title")?e:this.url?(0,J.vt)(this.url,pe)||"KML":e||""}set title(e){this._set("title",e)}get visibleSublayers(){const e=this.sublayers,r=[],o=s=>{s.visible&&(r.push(s),s.sublayers&&s.sublayers.forEach(o))};return e&&e.forEach(o),r}get fullExtent(){return this._recomputeFullExtent()}load(e){const r=(0,L.pC)(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["KML"],supportsData:!1},e).catch(Q.r9).then(()=>this._fetchService(r))),Promise.resolve(this)}destroy(){super.destroy(),this.allSublayers.destroy()}_fetchService(e){var r=this;return(0,B.Z)(function*(){const s=Y((yield Promise.resolve().then(()=>r.resourceInfo?{ssl:!1,data:r.resourceInfo}:z(r.url??"",r.outSpatialReference,r.refreshInterval,e))).data);s&&r.read(s,{origin:"service"})})()}_recomputeFullExtent(){let e=null;(0,L.pC)(this.extent)&&(e=this.extent.clone());const r=o=>{if(o.sublayers)for(const s of o.sublayers.items)r(s),s.visible&&s.fullExtent&&((0,L.pC)(e)?e.union(s.fullExtent):e=s.fullExtent.clone())};return r(this),e}};(0,n._)([(0,u.Cb)({readOnly:!0})],p.prototype,"allSublayers",void 0),(0,n._)([(0,u.Cb)({type:F.Z})],p.prototype,"outSpatialReference",void 0),(0,n._)([(0,u.Cb)({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],p.prototype,"path",void 0),(0,n._)([(0,u.Cb)({readOnly:!0,json:{read:!1,write:!1}})],p.prototype,"legendEnabled",void 0),(0,n._)([(0,u.Cb)({type:["show","hide","hide-children"]})],p.prototype,"listMode",void 0),(0,n._)([(0,u.Cb)({type:["KML"]})],p.prototype,"operationalLayerType",void 0),(0,n._)([(0,u.Cb)({})],p.prototype,"resourceInfo",void 0),(0,n._)([(0,u.Cb)({type:G.Z.ofType(W),json:{write:{ignoreOrigin:!0}}})],p.prototype,"sublayers",void 0),(0,n._)([(0,I.r)(["web-map","portal-item"],"sublayers",["visibleFolders"])],p.prototype,"readSublayersFromItemOrWebMap",null),(0,n._)([(0,I.r)("service","sublayers",["sublayers"])],p.prototype,"readSublayers",null),(0,n._)([(0,X.c)("sublayers")],p.prototype,"writeSublayers",null),(0,n._)([(0,u.Cb)({readOnly:!0,json:{read:!1}})],p.prototype,"type",void 0),(0,n._)([(0,u.Cb)({json:{origins:{"web-map":{read:{source:"title"}}},write:{ignoreOrigin:!0}}})],p.prototype,"title",null),(0,n._)([(0,u.Cb)(te.HQ)],p.prototype,"url",void 0),(0,n._)([(0,u.Cb)({readOnly:!0})],p.prototype,"visibleSublayers",null),(0,n._)([(0,u.Cb)({type:j.Z})],p.prototype,"extent",void 0),(0,n._)([(0,u.Cb)()],p.prototype,"fullExtent",null),p=(0,n._)([(0,U.j)("esri.layers.KMLLayer")],p);const fe=p}}]);