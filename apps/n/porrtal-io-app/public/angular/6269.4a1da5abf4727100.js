"use strict";(self.webpackChunka_porrtal_io_app=self.webpackChunka_porrtal_io_app||[]).push([[6269],{36592:(b,j,h)=>{h.d(j,{Q:()=>D});var A=h(85931),E=h(62208),S=h(77029),v=h(14259);class D{constructor(t=9,s){this.compareMinX=C,this.compareMinY=l,this._toBBox=e=>e,this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),s&&("function"==typeof s?this._toBBox=s:this._initFormat(s)),this.clear()}destroy(){this.clear(),U.prune(),X.prune(),M.prune(),Y.prune()}all(t){this._all(this.data,t)}search(t,s){let e=this.data;const r=this._toBBox;if(T(t,e))for(U.clear();e;){for(let o=0,d=e.children.length;o<d;o++){const c=e.children[o],f=e.leaf?r(c):c;T(t,f)&&(e.leaf?s(c):O(t,f)?this._all(c,s):U.push(c))}e=U.pop()}}collides(t){let s=this.data;const e=this._toBBox;if(!T(t,s))return!1;for(U.clear();s;){for(let r=0,o=s.children.length;r<o;r++){const d=s.children[r],c=s.leaf?e(d):d;if(T(t,c)){if(s.leaf||O(t,c))return!0;U.push(d)}}s=U.pop()}return!1}load(t){if(!t.length)return this;if(t.length<this._minEntries){for(let e=0,r=t.length;e<r;e++)this.insert(t[e]);return this}let s=this._build(t.slice(0,t.length),0,t.length-1,0);if(this.data.children.length)if(this.data.height===s.height)this._splitRoot(this.data,s);else{if(this.data.height<s.height){const e=this.data;this.data=s,s=e}this._insert(s,this.data.height-s.height-1,!0)}else this.data=s;return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=new i([]),this}remove(t){if(!t)return this;let s,e=this.data,r=null,o=0,d=!1;const c=this._toBBox(t);for(M.clear(),Y.clear();e||M.length>0;){if(e||(e=(0,E.j0)(M.pop()),r=M.data[M.length-1],o=Y.pop()??0,d=!0),e.leaf&&(s=(0,A.cq)(e.children,t,e.children.length,e.indexHint),-1!==s))return e.children.splice(s,1),M.push(e),this._condense(M),this;d||e.leaf||!O(e,c)?r?(o++,e=r.children[o],d=!1):e=null:(M.push(e),Y.push(o),o=0,r=e,e=e.children[0])}return this}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,s){let e=t;for(X.clear();e;){if(!0===e.leaf)for(const r of e.children)s(r);else X.pushArray(e.children);e=X.pop()??null}}_build(t,s,e,r){const o=e-s+1;let d=this._maxEntries;if(o<=d){const g=new i(t.slice(s,e+1));return u(g,this._toBBox),g}r||(r=Math.ceil(Math.log(o)/Math.log(d)),d=Math.ceil(o/d**(r-1)));const c=new _([]);c.height=r;const f=Math.ceil(o/d),B=f*Math.ceil(Math.sqrt(d));K(t,s,e,B,this.compareMinX);for(let g=s;g<=e;g+=B){const P=Math.min(g+B-1,e);K(t,g,P,f,this.compareMinY);for(let W=g;W<=P;W+=f){const F=Math.min(W+f-1,P);c.children.push(this._build(t,W,F,r-1))}}return u(c,this._toBBox),c}_chooseSubtree(t,s,e,r){for(;r.push(s),!0!==s.leaf&&r.length-1!==e;){let o,d=1/0,c=1/0;for(let f=0,B=s.children.length;f<B;f++){const g=s.children[f],P=p(g),W=m(t,g)-P;W<c?(c=W,d=P<d?P:d,o=g):W===c&&P<d&&(d=P,o=g)}s=o||s.children[0]}return s}_insert(t,s,e){const o=e?t:(0,this._toBBox)(t);M.clear();const d=this._chooseSubtree(o,this.data,s,M);for(d.children.push(t),I(d,o);s>=0&&M.data[s].children.length>this._maxEntries;)this._split(M,s),s--;this._adjustParentBBoxes(o,M,s)}_split(t,s){const e=t.data[s],r=e.children.length,o=this._minEntries;this._chooseSplitAxis(e,o,r);const d=this._chooseSplitIndex(e,o,r);if(!d)return void console.log("  Error: assertion failed at PooledRBush._split: no valid split index");const c=e.children.splice(d,e.children.length-d),f=e.leaf?new i(c):new _(c);f.height=e.height,u(e,this._toBBox),u(f,this._toBBox),s?t.data[s-1].children.push(f):this._splitRoot(e,f)}_splitRoot(t,s){this.data=new _([t,s]),this.data.height=t.height+1,u(this.data,this._toBBox)}_chooseSplitIndex(t,s,e){let r,o,d;r=o=1/0;for(let c=s;c<=e-s;c++){const f=y(t,0,c,this._toBBox),B=y(t,c,e,this._toBBox),g=x(f,B),P=p(f)+p(B);g<r?(r=g,d=c,o=P<o?P:o):g===r&&P<o&&(o=P,d=c)}return d}_chooseSplitAxis(t,s,e){const r=t.leaf?this.compareMinX:C,o=t.leaf?this.compareMinY:l;this._allDistMargin(t,s,e,r)<this._allDistMargin(t,s,e,o)&&t.children.sort(r)}_allDistMargin(t,s,e,r){t.children.sort(r);const o=this._toBBox,d=y(t,0,s,o),c=y(t,e-s,e,o);let f=a(d)+a(c);for(let B=s;B<e-s;B++){const g=t.children[B];I(d,t.leaf?o(g):g),f+=a(d)}for(let B=e-s-1;B>=s;B--){const g=t.children[B];I(c,t.leaf?o(g):g),f+=a(c)}return f}_adjustParentBBoxes(t,s,e){for(let r=e;r>=0;r--)I(s.data[r],t)}_condense(t){for(let s=t.length-1;s>=0;s--){const e=t.data[s];if(0===e.children.length)if(s>0){const r=t.data[s-1],o=r.children;o.splice((0,A.cq)(o,e,o.length,r.indexHint),1)}else this.clear();else u(e,this._toBBox)}}_initFormat(t){const s=["return a"," - b",";"];this.compareMinX=new Function("a","b",s.join(t[0])),this.compareMinY=new Function("a","b",s.join(t[1])),this._toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}function u(n,t){y(n,0,n.children.length,t,n)}function y(n,t,s,e,r){r||(r=new i([])),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let o,d=t;d<s;d++)o=n.children[d],I(r,n.leaf?e(o):o);return r}function I(n,t){n.minX=Math.min(n.minX,t.minX),n.minY=Math.min(n.minY,t.minY),n.maxX=Math.max(n.maxX,t.maxX),n.maxY=Math.max(n.maxY,t.maxY)}function C(n,t){return n.minX-t.minX}function l(n,t){return n.minY-t.minY}function p(n){return(n.maxX-n.minX)*(n.maxY-n.minY)}function a(n){return n.maxX-n.minX+(n.maxY-n.minY)}function m(n,t){return(Math.max(t.maxX,n.maxX)-Math.min(t.minX,n.minX))*(Math.max(t.maxY,n.maxY)-Math.min(t.minY,n.minY))}function x(n,t){const s=Math.max(n.minX,t.minX),e=Math.max(n.minY,t.minY),r=Math.min(n.maxX,t.maxX),o=Math.min(n.maxY,t.maxY);return Math.max(0,r-s)*Math.max(0,o-e)}function O(n,t){return n.minX<=t.minX&&n.minY<=t.minY&&t.maxX<=n.maxX&&t.maxY<=n.maxY}function T(n,t){return t.minX<=n.maxX&&t.minY<=n.maxY&&t.maxX>=n.minX&&t.maxY>=n.minY}function K(n,t,s,e,r){const o=[t,s];for(;o.length;){const d=(0,E.j0)(o.pop()),c=(0,E.j0)(o.pop());if(d-c<=e)continue;const f=c+Math.ceil((d-c)/e/2)*e;(0,v.q)(n,f,c,d,r),o.push(c,f,f,d)}}const U=new S.Z,X=new S.Z,M=new S.Z,Y=new S.Z({deallocator:void 0});class R{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class L extends R{constructor(){super(...arguments),this.height=1,this.indexHint=new A.SO}}class i extends L{constructor(t){super(),this.children=t,this.leaf=!0}}class _ extends L{constructor(t){super(),this.children=t,this.leaf=!1}}},61256:(b,j,h)=>{h.d(j,{H:()=>I});var A=h(8314),E=h(36592),S=h(65401);const D={minX:0,minY:0,maxX:0,maxY:0};class I{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new E.Q(9,(0,A.Z)("esri-csp-restrictions")?l=>({minX:l[0],minY:l[1],maxX:l[2],maxY:l[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const l=new Array(this._idByBounds.size);let p=0;this._idByBounds.forEach((a,m)=>{l[p++]=m}),this._indexInvalid=!1,this._index.clear(),this._index.load(l)}else this._boundsToLoad.length&&(this._index.load(this._boundsToLoad.filter(l=>this._idByBounds.has(l))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const l=(0,S.cS)();for(const p of this._boundsById.values())p&&(l[0]=Math.min(p[0],l[0]),l[1]=Math.min(p[1],l[1]),l[2]=Math.max(p[2],l[2]),l[3]=Math.max(p[3],l[3]));return l}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(l){const p=this._boundsById.get(l);this._boundsById.delete(l),p&&(this._idByBounds.delete(p),this._indexInvalid||this._index.remove(p))}forEachInBounds(l,p){this._loadIndex(),function y(C,l,p){(function u(C){D.minX=C[0],D.minY=C[1],D.maxX=C[2],D.maxY=C[3]})(l),C.search(D,p)}(this._index,l,a=>p(this._idByBounds.get(a)))}get(l){return this._boundsById.get(l)}has(l){return this._boundsById.has(l)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(l,p){if(!this._indexInvalid){const a=this._boundsById.get(l);a&&(this._index.remove(a),this._idByBounds.delete(a))}this._boundsById.set(l,p),p&&(this._idByBounds.set(p,l),this._indexInvalid||(this._boundsToLoad.push(p),this._boundsToLoad.length>5e4&&this._loadIndex()))}}},3579:(b,j,h)=>{h.d(j,{Z:()=>l});var A=h(26584),E=h(61885),S=h(63290),v=h(62208),D=h(5548),u=h(65401),y=h(82054),I=h(61256),C=h(92794);class l{constructor(a){this.geometryInfo=a,this._boundsStore=new I.H,this._featuresById=new Map,this._markedIds=new Set,this.events=new E.Z,this.featureAdapter=C.n}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let a=0;return this._featuresById.forEach(m=>{(0,v.pC)(m.geometry)&&m.geometry.coords&&(a+=m.geometry.coords.length)}),{featureCount:this._featuresById.size,vertexCount:a/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}add(a){this._add(a),this._emitChanged()}addMany(a){for(const m of a)this._add(m);this._emitChanged()}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}removeById(a){const m=this._featuresById.get(a);return m?(this._remove(m),this._emitChanged(),m):null}removeManyById(a){this._boundsStore.invalidateIndex();for(const m of a){const x=this._featuresById.get(m);x&&this._remove(x)}this._emitChanged()}forEachBounds(a,m,x){for(const O of a){const T=this._boundsStore.get(O.objectId);T&&m((0,D.JR)(x,T))}}getFeature(a){return this._featuresById.get(a)}has(a){return this._featuresById.has(a)}toArray(){return Array.from(this._featuresById.values())}forEach(a){this._featuresById.forEach(m=>a(m))}forEachInBounds(a,m){this._boundsStore.forEachInBounds(a,x=>{m(this._featuresById.get(x))})}startMarkingUsedFeatures(){this._boundsStore.invalidateIndex(),this._markedIds.clear()}sweep(){let a=!1;this._featuresById.forEach((m,x)=>{this._markedIds.has(x)||(a=!0,this._remove(m))}),this._markedIds.clear(),a&&this._emitChanged()}_emitChanged(){this.events.emit("changed",void 0)}_add(a){if(!a)return;const m=a.objectId;if(null==m)return void S.Z.getLogger("esri.layers.graphics.data.FeatureStore").error(new A.Z("featurestore:invalid-feature","feature id is missing",{feature:a}));const x=this._featuresById.get(m);let O;if(this._markedIds.add(m),x?(a.displayId=x.displayId,O=this._boundsStore.get(m),this._boundsStore.delete(m)):(0,v.pC)(this.onFeatureAdd)&&this.onFeatureAdd(a),(0,v.Wi)(a.geometry)||!a.geometry.coords||!a.geometry.coords.length)return this._boundsStore.set(m,null),void this._featuresById.set(m,a);O=(0,y.$)((0,v.pC)(O)?O:(0,u.Ue)(),a.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),(0,v.pC)(O)&&this._boundsStore.set(m,O),this._featuresById.set(m,a)}_remove(a){return(0,v.pC)(this.onFeatureRemove)&&this.onFeatureRemove(a),this._markedIds.delete(a.objectId),this._boundsStore.delete(a.objectId),this._featuresById.delete(a.objectId),a}}},92794:(b,j,h)=>{h.d(j,{n:()=>D});var A=h(62208),E=h(77044),S=h(66385),v=h(88071);const D={getObjectId:u=>u.objectId,getAttributes:u=>u.attributes,getAttribute:(u,y)=>u.attributes[y],cloneWithGeometry:(u,y)=>new S.u_(y,u.attributes,null,u.objectId),getGeometry:u=>u.geometry,getCentroid:(u,y)=>((0,A.Wi)(u.centroid)&&(u.centroid=(0,E.Y)(new v.Z,u.geometry,y.hasZ,y.hasM)),u.centroid)}},66269:(b,j,h)=>{h.r(j),h.d(j,{GraphicsSnappingSource:()=>R});var A=h(15861),E=h(17626),S=h(14517),v=h(85931),D=h(80542),u=h(62208),y=h(10699),I=h(77712),p=(h(8314),h(90912),h(76898)),a=h(37118),m=h(55915),x=h(65629),O=h(71774),T=h(82054),K=h(66385),U=h(3579),X=h(58175),M=h(44725),Y=h(9218);let R=class extends((0,D.p)(S.Z)){constructor(i){super(i),this.availability=1,this.sources={multipoint:null,point:null,polygon:null,polyline:null},this.loadedWkids=new Set,this.loadedWkts=new Set,this.pendingAdds=[]}get updating(){return this.updatingHandles.updating}get layer(){return this.layerSource.layer}destroy(){const i=this.pendingAdds;this.pendingAdds.length=0;for(const _ of i)_.task.abort();this._mapSources(_=>this._destroySource(_))}initialize(){this.handles.add([this.layer.on("graphic-update",i=>this._onGraphicUpdate(i)),this.updatingHandles.addOnCollectionChange(()=>this.layer.graphics,i=>this._onGraphicsChanged(i))]),this._addMany(this.layer.graphics.toArray())}fetchCandidates(i,_){var n=this;return(0,A.Z)(function*(){const s=(yield(0,y.WW)(n._mapSources(e=>e.queryEngine.executeQueryForSnapping({point:i.coordinateHelper.vectorToPoint(i.point).toJSON(),distance:i.distance,types:i.types,query:(0,u.pC)(i.filter)?i.filter.createQuery().toJSON():{where:"1=1"}},_).then(({candidates:r})=>r)))).flat().map(e=>(0,Y.X)(e,i.coordinateHelper,i.elevationInfo));return(0,M.lQ)(i.point,s),s})()}refresh(){}_onGraphicUpdate(i){switch(i.property){case"geometry":case"visible":this._remove(i.graphic),this._addMany([i.graphic])}}_onGraphicsChanged(i){for(const _ of i.removed)this._remove(_);this._addMany(i.added)}_addMany(i){const _=[],n=new Map;for(const t of i)(0,u.Wi)(t.geometry)||(this._needsInitializeProjection(t.geometry.spatialReference)?(_.push(t.geometry.spatialReference),n.set(t.uid,t)):this._add(t));this._createPendingAdd(_,n)}_createPendingAdd(i,_){var n=this;if(!i.length)return;const t=(0,y.vr)(function(){var r=(0,A.Z)(function*(o){yield(0,m.iQ)(i.map(d=>({source:d,dest:n.spatialReference})),{signal:o}),n._markLoadedSpatialReferences(i);for(const[,d]of _)n._add(d)});return function(o){return r.apply(this,arguments)}}());this.updatingHandles.addPromise(t.promise);const s={task:t,graphics:_},e=()=>(0,v.e$)(this.pendingAdds,s);t.promise.then(e,e),this.pendingAdds.push(s)}_markLoadedSpatialReferences(i){for(const _ of i)null!=_.wkid&&this.loadedWkids.add(_.wkid),null!=_.wkt&&this.loadedWkts.add(_.wkt)}_add(i){if((0,u.Wi)(i.geometry)||!i.visible)return;let _=i.geometry;if("mesh"===_.type)return;"extent"===_.type&&(_=a.Z.fromExtent(_));const n=this._ensureSource(_.type);if((0,u.Wi)(n))return;const t=this._createOptimizedFeature(i.uid,_);(0,u.pC)(t)&&n.featureStore.add(t)}_needsInitializeProjection(i){return!(null!=i.wkid&&this.loadedWkids.has(i.wkid)||null!=i.wkt&&this.loadedWkts.has(i.wkt)||(0,m.Up)(i,this.spatialReference))}_createOptimizedFeature(i,_){const n=(0,m.iV)((0,x.SR)(_),this.spatialReference);return n?new K.u_((0,T.GH)(n,!1,!1),{[L]:i},null,i):null}_ensureSource(i){const _=this.sources[i];if((0,u.pC)(_))return _;const n=this._createSource(i);return this.sources[i]=n,n}_createSource(i){const _=O.Mk.toJSON(i),n=new U.Z({geometryType:_,hasZ:!1,hasM:!1});return{featureStore:n,queryEngine:new X.q({featureStore:n,fields:[{name:L,type:"esriFieldTypeOID",alias:L}],geometryType:_,hasM:!1,hasZ:!1,objectIdField:L,spatialReference:this.spatialReference,scheduler:(0,u.pC)(this.view)&&"3d"===this.view.type?this.view.resourceController.scheduler:null}),type:i}}_remove(i){this._mapSources(_=>this._removeFromSource(_,i));for(const _ of this.pendingAdds)_.graphics.delete(i.uid),0===_.graphics.size&&_.task.abort()}_removeFromSource(i,_){i.featureStore.has(_.uid)&&i.featureStore.removeById(_.uid)}_destroySource(i){i.queryEngine.destroy(),this.sources[i.type]=null}_mapSources(i){const{point:_,polygon:n,polyline:t,multipoint:s}=this.sources,e=[];return(0,u.pC)(_)&&e.push(i(_)),(0,u.pC)(n)&&e.push(i(n)),(0,u.pC)(t)&&e.push(i(t)),(0,u.pC)(s)&&e.push(i(s)),e}};(0,E._)([(0,I.Cb)({constructOnly:!0})],R.prototype,"spatialReference",void 0),(0,E._)([(0,I.Cb)({constructOnly:!0})],R.prototype,"layerSource",void 0),(0,E._)([(0,I.Cb)({constructOnly:!0})],R.prototype,"view",void 0),(0,E._)([(0,I.Cb)({readOnly:!0})],R.prototype,"updating",null),(0,E._)([(0,I.Cb)({readOnly:!0})],R.prototype,"availability",void 0),R=(0,E._)([(0,p.j)("esri.views.interactive.snapping.featureSources.GraphicsSnappingSource")],R);const L="OBJECTID"}}]);