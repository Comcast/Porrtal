"use strict";(self.webpackChunka_porrtal_io_app=self.webpackChunka_porrtal_io_app||[]).push([[2480],{82480:(_e,X,g)=>{g.r(X),g.d(X,{registerFunctions:()=>pe});var P=g(15861),R=g(37780),M=g(6729),re=g(42275),z=g(90512),w=g(7712),ae=g(7652),ie=g(98362),n=g(47562),E=g(52724),J=g(53997),se=g(95896),le=g(79429),oe=g(62074),ue=g(16776),fe=g(57366),W=g(77132),k=g(83947),$=g(50818),ce=g(10699),D=g(10410),Z=g(32258),L=g(36255);function B(i,a,y){return j.apply(this,arguments)}function j(){return(j=(0,P.Z)(function*(i,a,y){const m=i.getVariables();if(m.length>0){const h=[];for(let e=0;e<m.length;e++){const r={name:m[e]};h.push(yield a.evaluateIdentifier(y,r))}const u={};for(let e=0;e<m.length;e++)u[m[e]]=h[e];return i.parameters=u,i}return i})).apply(this,arguments)}function c(i,a,y=null){for(const m in i)if(m.toLowerCase()===a.toLowerCase())return i[m];return y}function Q(i){if(null===i)return null;const a={type:c(i,"type",""),name:c(i,"name","")};if("range"===a.type)a.range=c(i,"range",[]);else{a.codedValues=[];for(const y of c(i,"codedValues",[]))a.codedValues.push({name:c(y,"name",""),code:c(y,"code",null)})}return a}function U(i){if(null===i)return null;const a={},y=c(i,"wkt",null);null!==y&&(a.wkt=y);const m=c(i,"wkid",null);return null!==m&&(a.wkid=m),a}function Y(i){if(null===i)return null;const a={hasZ:c(i,"hasz",!1),hasM:c(i,"hasm",!1)},y=c(i,"spatialreference",null);y&&(a.spatialReference=U(y));const m=c(i,"x",null);if(null!==m)return a.x=m,a.y=c(i,"y",null),a;const h=c(i,"rings",null);if(null!==h)return a.rings=h,a;const u=c(i,"paths",null);if(null!==u)return a.paths=u,a;const e=c(i,"points",null);if(null!==e)return a.points=e,a;for(const r of["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"]){const o=c(i,r,null);null!==o&&(a[r]=o)}return a}function pe(i){"async"===i.mode&&(i.functions.getuser=function(a,y){return i.standardFunctionAsync(a,y,function(){var m=(0,P.Z)(function*(h,u,e){(0,n.p)(e,1,2);let r=(0,n.C)(e[1],""),o=!0===r;if(r=!0===r||!1===r?"":(0,n.h)(r),e[0]instanceof R.Z){let d=null;a.services&&a.services.portal&&(d=a.services.portal),d=(0,w.getPortal)(e[0],d);const s=yield(0,w.lookupUser)(d,r,o);if(s){const t=JSON.parse(JSON.stringify(s));for(const l of["lastLogin","created","modified"])null!=t[l]&&(t[l]=new Date(t[l]));return M.Z.convertObjectToArcadeDictionary(t)}return null}let p=null;if((0,n.y)(e[0])&&(p=e[0]),p){if(o=!1,r)return null;yield p.load();const d=yield p.getOwningSystemUrl();if(!d){if(!r){const l=yield p.getIdentityUser();return l?M.Z.convertObjectToArcadeDictionary({username:l}):null}return null}let s=null;a.services&&a.services.portal&&(s=a.services.portal),s=(0,w.getPortal)(new R.Z(d),s);const t=yield(0,w.lookupUser)(s,r,o);if(t){const l=JSON.parse(JSON.stringify(t));for(const f of["lastLogin","created","modified"])null!=l[f]&&(l[f]=new Date(l[f]));return M.Z.convertObjectToArcadeDictionary(l)}return null}throw new Error("Invalid Parameter")});return function(h,u,e){return m.apply(this,arguments)}}())},i.signatures.push({name:"getuser",min:"1",max:"2"}),i.functions.featuresetbyid=function(a,y){return i.standardFunctionAsync(a,y,(m,h,u)=>{if((0,n.p)(u,2,4),u[0]instanceof z.Z){const e=(0,n.h)(u[1]);let r=(0,n.C)(u[2],null);const o=(0,n.g)((0,n.C)(u[3],!0));if(null===r&&(r=["*"]),!1===(0,n.l)(r))throw new Error("Invalid Parameter");return u[0].featureSetById(e,o,r)}throw new Error("Invalid Parameter")})},i.signatures.push({name:"featuresetbyid",min:"2",max:"4"}),i.functions.getfeatureset=function(a,y){return i.standardFunctionAsync(a,y,(m,h,u)=>{if((0,n.p)(u,1,2),(0,n.s)(u[0])){let e=(0,n.C)(u[1],"datasource");return null===e&&(e="datasource"),e=(0,n.h)(e).toLowerCase(),(0,w.convertToFeatureSet)(u[0].fullSchema(),e,a.lrucache,a.interceptor,a.spatialReference)}throw new Error("Invalid Parameter")})},i.signatures.push({name:"getfeatureset",min:"1",max:"2"}),i.functions.featuresetbyportalitem=function(a,y){return i.standardFunctionAsync(a,y,(m,h,u)=>{if((0,n.p)(u,2,5),null===u[0])throw new Error("Portal is required");if(u[0]instanceof R.Z){const d=(0,n.h)(u[1]),s=(0,n.h)(u[2]);let t=(0,n.C)(u[3],null);const l=(0,n.g)((0,n.C)(u[4],!0));if(null===t&&(t=["*"]),!1===(0,n.l)(t))throw new Error("Invalid Parameter");let f=null;return a.services&&a.services.portal&&(f=a.services.portal),f=(0,w.getPortal)(u[0],f),(0,w.constructFeatureSetFromPortalItem)(d,s,a.spatialReference,t,l,f,a.lrucache,a.interceptor)}if(!1===(0,n.b)(u[0]))throw new Error("Portal is required");const e=(0,n.h)(u[0]),r=(0,n.h)(u[1]);let o=(0,n.C)(u[2],null);const p=(0,n.g)((0,n.C)(u[3],!0));if(null===o&&(o=["*"]),!1===(0,n.l)(o))throw new Error("Invalid Parameter");if(a.services&&a.services.portal)return(0,w.constructFeatureSetFromPortalItem)(e,r,a.spatialReference,o,p,a.services.portal,a.lrucache,a.interceptor);throw new Error("Portal is required")})},i.signatures.push({name:"featuresetbyportalitem",min:"2",max:"5"}),i.functions.featuresetbyname=function(a,y){return i.standardFunctionAsync(a,y,(m,h,u)=>{if((0,n.p)(u,2,4),u[0]instanceof z.Z){const e=(0,n.h)(u[1]);let r=(0,n.C)(u[2],null);const o=(0,n.g)((0,n.C)(u[3],!0));if(null===r&&(r=["*"]),!1===(0,n.l)(r))throw new Error("Invalid Parameter");return u[0].featureSetByName(e,o,r)}throw new Error("Invalid Parameter")})},i.signatures.push({name:"featuresetbyname",min:"2",max:"4"}),i.functions.featureset=function(a,y){return i.standardFunction(a,y,(m,h,u)=>{(0,n.p)(u,1,1);let e=u[0];const r={layerDefinition:{geometryType:"",objectIdField:"",globalIdField:"",typeIdField:"",fields:[]},featureSet:{geometryType:"",features:[]}};if((0,n.b)(e))e=JSON.parse(e),void 0!==e.layerDefinition?(r.layerDefinition=e.layerDefinition,r.featureSet=e.featureSet,e.layerDefinition.spatialReference&&(r.layerDefinition.spatialReference=e.layerDefinition.spatialReference)):(r.featureSet.features=e.features,r.featureSet.geometryType=e.geometryType,r.layerDefinition.geometryType=r.featureSet.geometryType,r.layerDefinition.objectIdField=e.objectIdFieldName,r.layerDefinition.typeIdField=e.typeIdFieldName,r.layerDefinition.globalIdField=e.globalIdFieldName,r.layerDefinition.fields=e.fields,e.spatialReference&&(r.layerDefinition.spatialReference=e.spatialReference));else{if(!(u[0]instanceof M.Z))throw new Error("Invalid Parameter");{e=JSON.parse(u[0].castToText());const o=c(e,"layerdefinition");if(null!==o){r.layerDefinition.geometryType=c(o,"geometrytype",""),r.featureSet.geometryType=r.layerDefinition.geometryType,r.layerDefinition.globalIdField=c(o,"globalidfield",""),r.layerDefinition.objectIdField=c(o,"objectidfield",""),r.layerDefinition.typeIdField=c(o,"typeidfield","");const p=c(o,"spatialreference",null);p&&(r.layerDefinition.spatialReference=U(p));for(const s of c(o,"fields",[])){const t={name:c(s,"name",""),alias:c(s,"alias",""),type:c(s,"type",""),nullable:c(s,"nullable",!0),editable:c(s,"editable",!0),length:c(s,"length",null),domain:Q(c(s,"domain"))};r.layerDefinition.fields.push(t)}const d=c(e,"featureset",null);if(d){const s={};for(const t of r.layerDefinition.fields)s[t.name.toLowerCase()]=t.name;for(const t of c(d,"features",[])){const l={},f=c(t,"attributes",{});for(const A in f)l[s[A.toLowerCase()]]=f[A];r.featureSet.features.push({attributes:l,geometry:Y(c(t,"geometry",null))})}}}else{r.layerDefinition.geometryType=c(e,"geometrytype",""),r.featureSet.geometryType=r.layerDefinition.geometryType,r.layerDefinition.objectIdField=c(e,"objectidfieldname",""),r.layerDefinition.typeIdField=c(e,"typeidfieldname","");const p=c(e,"spatialreference",null);p&&(r.layerDefinition.spatialReference=U(p));for(const s of c(e,"fields",[])){const t={name:c(s,"name",""),alias:c(s,"alias",""),type:c(s,"type",""),nullable:c(s,"nullable",!0),editable:c(s,"editable",!0),length:c(s,"length",null),domain:Q(c(s,"domain"))};r.layerDefinition.fields.push(t)}const d={};for(const s of r.layerDefinition.fields)d[s.name.toLowerCase()]=s.name;for(const s of c(e,"features",[])){const t={},l=c(s,"attributes",{});for(const f in l)t[d[f.toLowerCase()]]=l[f];r.featureSet.features.push({attributes:t,geometry:Y(c(s,"geometry",null))})}}}}if(!1===function me(i){return!!i.layerDefinition&&!!i.featureSet&&!1!==function ye(i,a){for(const y of a)if(y===i)return!0;return!1}(i.layerDefinition.geometryType,["","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"])&&null!==i.layerDefinition.objectIdField&&""!==i.layerDefinition.objectIdField&&!1!==(0,n.l)(i.layerDefinition.fields)&&!1!==(0,n.l)(i.featureSet.features)}(r))throw new Error("Invalid Parameter");return ue.Z.create(r,a.spatialReference)})},i.signatures.push({name:"featureset",min:"1",max:"1"}),i.functions.filter=function(a,y){return i.standardFunctionAsync(a,y,function(){var m=(0,P.Z)(function*(h,u,e){if((0,n.p)(e,2,2),(0,n.l)(e[0])||(0,n.n)(e[0])){const r=[];let o=e[0];o instanceof ie.Z&&(o=o.toArray());let p=null;if(e[1]instanceof ae.Z)p=i.arcadeCustomFunctionHandler(e[1]);else if(e[1]instanceof n.N)p=(...d)=>e[1].fn(a,{preparsed:!0,arguments:d});else{if(!(e[1]instanceof n.S))throw new Error("Invalid Parameter");p=(...d)=>{if(d.length!==e[1].paramCount)throw new Error("Invalid parameters");return e[1].fn(...d)}}for(const d of o){const s=p(d);(0,ce.y8)(s)?!0===(yield s)&&r.push(d):!0===s&&r.push(d)}return r}if((0,n.y)(e[0])){const r=yield e[0].load(),o=D.WhereClause.create(e[1],r.getFieldsIndex()),p=o.getVariables();if(p.length>0){const d=[];for(let t=0;t<p.length;t++){const l={name:p[t]};d.push(yield i.evaluateIdentifier(a,l))}const s={};for(let t=0;t<p.length;t++)s[p[t]]=d[t];return o.parameters=s,new J.Z({parentfeatureset:e[0],whereclause:o})}return new J.Z({parentfeatureset:e[0],whereclause:o})}throw new Error("Filter cannot accept this parameter type")});return function(h,u,e){return m.apply(this,arguments)}}())},i.signatures.push({name:"filter",min:"2",max:"2"}),i.functions.orderby=function(a,y){return i.standardFunctionAsync(a,y,function(){var m=(0,P.Z)(function*(h,u,e){if((0,n.p)(e,2,2),(0,n.y)(e[0])){const r=new fe.Z(e[1]);return new se.Z({parentfeatureset:e[0],orderbyclause:r})}throw new Error("Order cannot accept this parameter type")});return function(h,u,e){return m.apply(this,arguments)}}())},i.signatures.push({name:"orderby",min:"2",max:"2"}),i.functions.top=function(a,y){return i.standardFunctionAsync(a,y,function(){var m=(0,P.Z)(function*(h,u,e){if((0,n.p)(e,2,2),(0,n.y)(e[0]))return new le.Z({parentfeatureset:e[0],topnum:e[1]});if((0,n.l)(e[0]))return(0,n.f)(e[1])>=e[0].length?e[0].slice(0):e[0].slice(0,(0,n.f)(e[1]));if((0,n.n)(e[0]))return(0,n.f)(e[1])>=e[0].length()?e[0].slice(0):e[0].slice(0,(0,n.f)(e[1]));throw new Error("Top cannot accept this parameter type")});return function(h,u,e){return m.apply(this,arguments)}}())},i.signatures.push({name:"top",min:"2",max:"2"}),i.functions.first=function(a,y){return i.standardFunctionAsync(a,y,function(){var m=(0,P.Z)(function*(h,u,e){if((0,n.p)(e,1,1),(0,n.y)(e[0])){const r=yield e[0].first(h.abortSignal);if(null!==r){const o=re.Z.createFromGraphicLikeObject(r.geometry,r.attributes,e[0]);return o._underlyingGraphic=r,o}return r}return(0,n.l)(e[0])?0===e[0].length?null:e[0][0]:(0,n.n)(e[0])?0===e[0].length()?null:e[0].get(0):null});return function(h,u,e){return m.apply(this,arguments)}}())},i.signatures.push({name:"first",min:"1",max:"1"}),i.functions.attachments=function(a,y){return i.standardFunctionAsync(a,y,function(){var m=(0,P.Z)(function*(h,u,e){(0,n.p)(e,1,2);const r={minsize:-1,maxsize:-1,types:null,returnMetadata:!1};if(e.length>1)if(e[1]instanceof M.Z){if(e[1].hasField("minsize")&&(r.minsize=(0,n.f)(e[1].field("minsize"))),e[1].hasField("metadata")&&(r.returnMetadata=(0,n.g)(e[1].field("metadata"))),e[1].hasField("maxsize")&&(r.maxsize=(0,n.f)(e[1].field("maxsize"))),e[1].hasField("types")){const o=(0,n.Y)(e[1].field("types"),!1);o.length>0&&(r.types=o)}}else if(null!==e[1])throw new Error("Invalid Parameter");if((0,n.s)(e[0])){let o=e[0]._layer;return o instanceof Z.default&&(o=(0,w.constructFeatureSet)(o,a.spatialReference,["*"],!0,a.lrucache,a.interceptor)),null===o||!1===(0,n.y)(o)?[]:(yield o.load(),o.queryAttachments(e[0].field(o.objectIdField),r.minsize,r.maxsize,r.types,r.returnMetadata))}if(null===e[0])return[];throw new Error("Invalid Parameter")});return function(h,u,e){return m.apply(this,arguments)}}())},i.signatures.push({name:"attachments",min:"1",max:"2"}),i.functions.featuresetbyrelationshipname=function(a,y){return i.standardFunctionAsync(a,y,function(){var m=(0,P.Z)(function*(h,u,e){(0,n.p)(e,2,4);const r=e[0],o=(0,n.h)(e[1]);let p=(0,n.C)(e[2],null);const d=(0,n.g)((0,n.C)(e[3],!0));if(null===p&&(p=["*"]),!1===(0,n.l)(p))throw new Error("Invalid Parameter");if(null===e[0])return null;if(!(0,n.s)(e[0]))throw new Error("Invalid Parameter");let s=r._layer;if(s instanceof Z.default&&(s=(0,w.constructFeatureSet)(s,a.spatialReference,["*"],!0,a.lrucache,a.interceptor)),null===s||!1===(0,n.y)(s))return null;s=yield s.load();const t=s.relationshipMetaData().filter(F=>F.name===o);if(0===t.length)return null;if(null!=t[0].relationshipTableId&&t[0].relationshipTableId>-1)return(0,w.constructFeatureSetFromRelationship)(s,t[0],r.field(s.objectIdField),s.spatialReference,p,d,a.lrucache,a.interceptor);let l=s.serviceUrl();if(!l)return null;l="/"===l.charAt(l.length-1)?l+t[0].relatedTableId.toString():l+"/"+t[0].relatedTableId.toString();const f=yield(0,w.constructFeatureSetFromUrl)(l,s.spatialReference,p,d,a.lrucache,a.interceptor);yield f.load();let A=f.relationshipMetaData();if(A=A.filter(F=>F.id===t[0].id),!1===r.hasField(t[0].keyField)||null===r.field(t[0].keyField)){const F=yield s.getFeatureByObjectId(r.field(s.objectIdField),[t[0].keyField]);if(F){const x=D.WhereClause.create(A[0].keyField+"= @id",f.getFieldsIndex());return x.parameters={id:F.attributes[t[0].keyField]},f.filter(x)}return new oe.Z({parentfeatureset:f})}const C=D.WhereClause.create(A[0].keyField+"= @id",f.getFieldsIndex());return C.parameters={id:r.field(t[0].keyField)},f.filter(C)});return function(h,u,e){return m.apply(this,arguments)}}())},i.signatures.push({name:"featuresetbyrelationshipname",min:"2",max:"4"}),i.functions.featuresetbyassociation=function(a,y){return i.standardFunctionAsync(a,y,function(){var m=(0,P.Z)(function*(h,u,e){(0,n.p)(e,2,3);const r=e[0],o=(0,n.h)((0,n.C)(e[1],"")).toLowerCase(),p=(0,n.b)(e[2])?(0,n.h)(e[2]):null;if(null===e[0])return null;if(!(0,n.s)(e[0]))throw new Error("Invalid Parameter");let d=r._layer;if(d instanceof Z.default&&(d=(0,w.constructFeatureSet)(d,a.spatialReference,["*"],!0,a.lrucache,a.interceptor)),null===d||!1===(0,n.y)(d))return null;yield d.load();const s=d.serviceUrl(),t=yield(0,w.constructAssociationMetaDataFeatureSetFromUrl)(s,a.spatialReference);let l=null,f=null,A=!1;if(null!==p&&""!==p&&void 0!==p){for(const I of t.terminals)I.terminalName===p&&(f=I.terminalId);null===f&&(A=!0)}const C=t.associations.getFieldsIndex(),F=C.get("TOGLOBALID").name,x=C.get("FROMGLOBALID").name,K=C.get("TOTERMINALID").name,G=C.get("FROMTERMINALID").name,S=C.get("FROMNETWORKSOURCEID").name,b=C.get("TONETWORKSOURCEID").name,T=C.get("ASSOCIATIONTYPE").name,he=C.get("ISCONTENTVISIBLE").name,Ee=C.get("OBJECTID").name;for(const I of d.fields)if("global-id"===I.type){l=r.field(I.name);break}let v=null,q=new E.yN(new L.Z({name:"percentalong",alias:"percentalong",type:"double"}),D.WhereClause.create("0",t.associations.getFieldsIndex())),V=new E.yN(new L.Z({name:"side",alias:"side",type:"string"}),D.WhereClause.create("''",t.associations.getFieldsIndex()));const O="globalid",ee="globalId",te={};for(const I in t.lkp)te[I]=t.lkp[I].sourceId;const N=new E.TO(new L.Z({name:"classname",alias:"classname",type:"string"}),null,te);let _="";switch(o){case"midspan":{_=`((${F}='${l}') OR ( ${x}='${l}')) AND (${T} IN (5))`,N.codefield=D.WhereClause.create(`CASE WHEN (${F}='${l}') THEN ${S} ELSE ${b} END`,t.associations.getFieldsIndex());const I=(0,W.JW)(E.Xx.findField(t.associations.fields,x));I.name=O,I.alias=O,v=new E.yN(I,D.WhereClause.create(`CASE WHEN (${x}='${l}') THEN ${F} ELSE ${x} END`,t.associations.getFieldsIndex())),q=t.unVersion>=4?new E.$X(E.Xx.findField(t.associations.fields,C.get("PERCENTALONG").name)):new E.yN(new L.Z({name:"percentalong",alias:"percentalong",type:"double"}),D.WhereClause.create("0",t.associations.getFieldsIndex()));break}case"junctionedge":{_=`((${F}='${l}') OR ( ${x}='${l}')) AND (${T} IN (4,6))`,N.codefield=D.WhereClause.create(`CASE WHEN (${F}='${l}') THEN ${S} ELSE ${b} END`,t.associations.getFieldsIndex());const I=(0,W.JW)(E.Xx.findField(t.associations.fields,x));I.name=O,I.alias=O,v=new E.yN(I,D.WhereClause.create(`CASE WHEN (${x}='${l}') THEN ${F} ELSE ${x} END`,t.associations.getFieldsIndex())),V=new E.yN(new L.Z({name:"side",alias:"side",type:"string"}),D.WhereClause.create(`CASE WHEN (${T}=4) THEN 'from' ELSE 'to' END`,t.associations.getFieldsIndex()));break}case"connected":{let I=`${F}='@T'`,ne=`${x}='@T'`;null!==f&&(I+=` AND ${K}=@A`,ne+=` AND ${G}=@A`),_="(("+I+") OR ("+ne+"))",_=(0,n.M)(_,"@T",l),I=(0,n.M)(I,"@T",l),null!==f&&(I=(0,n.M)(I,"@A",f.toString()),_=(0,n.M)(_,"@A",f.toString())),N.codefield=D.WhereClause.create("CASE WHEN "+I+` THEN ${S} ELSE ${b} END`,t.associations.getFieldsIndex());const H=(0,W.JW)(E.Xx.findField(t.associations.fields,x));H.name=O,H.alias=O,v=new E.yN(H,D.WhereClause.create("CASE WHEN "+I+` THEN ${x} ELSE ${F} END`,t.associations.getFieldsIndex()));break}case"container":_=`${F}='${l}' AND ${T} = 2`,null!==f&&(_+=` AND ${K} = `+f.toString()),N.codefield=S,_="( "+_+" )",v=new E.QP(E.Xx.findField(t.associations.fields,x),O,O);case"content":_=`(${x}='${l}' AND ${T} = 2)`,null!==f&&(_+=` AND ${G} = `+f.toString()),N.codefield=b,_="( "+_+" )",v=new E.QP(E.Xx.findField(t.associations.fields,F),O,O);break;case"structure":_=`(${F}='${l}' AND ${T} = 3)`,null!==f&&(_+=` AND ${K} = `+f.toString()),N.codefield=S,_="( "+_+" )",v=new E.QP(E.Xx.findField(t.associations.fields,x),O,ee);break;case"attached":_=`(${x}='${l}' AND ${T} = 3)`,null!==f&&(_+=` AND ${G} = `+f.toString()),N.codefield=b,_="( "+_+" )",v=new E.QP(E.Xx.findField(t.associations.fields,F),O,ee);break;default:throw new Error("Invalid Parameter")}return A&&(_="1 <> 1"),new E.Xx({parentfeatureset:t.associations,adaptedFields:[new E.$X(E.Xx.findField(t.associations.fields,Ee)),new E.$X(E.Xx.findField(t.associations.fields,he)),v,V,N,q],extraFilter:_?D.WhereClause.create(_,t.associations.getFieldsIndex()):null})});return function(h,u,e){return m.apply(this,arguments)}}())},i.signatures.push({name:"featuresetbyassociation",min:"2",max:"6"}),i.functions.groupby=function(a,y){return i.standardFunctionAsync(a,y,function(){var m=(0,P.Z)(function*(h,u,e){if((0,n.p)(e,3,3),!(0,n.y)(e[0]))throw new Error("Illegal Value: GroupBy");const r=yield e[0].load(),o=[],p=[];let d=!1,s=[];if((0,n.b)(e[1]))s.push(e[1]);else if(e[1]instanceof M.Z)s.push(e[1]);else if((0,n.l)(e[1]))s=e[1];else{if(!(0,n.n)(e[1]))throw new Error("Illegal Value: GroupBy");s=e[1].toArray()}for(const t of s)if((0,n.b)(t)){const l=D.WhereClause.create((0,n.h)(t),r.getFieldsIndex()),f=!0===(0,k.y5)(l)?(0,n.h)(t):"%%%%FIELDNAME";o.push({name:f,expression:l}),"%%%%FIELDNAME"===f&&(d=!0)}else{if(!(t instanceof M.Z))throw new Error("Illegal Value: GroupBy");{const l=t.hasField("name")?t.field("name"):"%%%%FIELDNAME",f=t.hasField("expression")?t.field("expression"):"";if("%%%%FIELDNAME"===l&&(d=!0),!l)throw new Error("Illegal Value: GroupBy");o.push({name:l,expression:D.WhereClause.create(f||l,r.getFieldsIndex())})}}if(s=[],(0,n.b)(e[2]))s.push(e[2]);else if((0,n.l)(e[2]))s=e[2];else if((0,n.n)(e[2]))s=e[2].toArray();else{if(!(e[2]instanceof M.Z))throw new Error("Illegal Value: GroupBy");s.push(e[2])}for(const t of s){if(!(t instanceof M.Z))throw new Error("Illegal Value: GroupBy");{const l=t.hasField("name")?t.field("name"):"",f=t.hasField("statistic")?t.field("statistic"):"",A=t.hasField("expression")?t.field("expression"):"";if(!l||!f||!A)throw new Error("Illegal Value: GroupBy");p.push({name:l,statistic:f.toLowerCase(),expression:D.WhereClause.create(A,r.getFieldsIndex())})}}if(d){const t={};for(const f of r.fields)t[f.name.toLowerCase()]=1;for(const f of o)"%%%%FIELDNAME"!==f.name&&(t[f.name.toLowerCase()]=1);for(const f of p)"%%%%FIELDNAME"!==f.name&&(t[f.name.toLowerCase()]=1);let l=0;for(const f of o)if("%%%%FIELDNAME"===f.name){for(;1===t["field_"+l.toString()];)l++;t["field_"+l.toString()]=1,f.name="FIELD_"+l.toString()}}for(const t of o)yield B(t.expression,i,a);for(const t of p)yield B(t.expression,i,a);return e[0].groupby(o,p)});return function(h,u,e){return m.apply(this,arguments)}}())},i.signatures.push({name:"groupby",min:"3",max:"3"}),i.functions.distinct=function(a,y){return i.standardFunctionAsync(a,y,function(){var m=(0,P.Z)(function*(h,u,e){if((0,n.y)(e[0])){(0,n.p)(e,2,2);const r=yield e[0].load(),o=[];let p=[];if((0,n.b)(e[1]))p.push(e[1]);else if(e[1]instanceof M.Z)p.push(e[1]);else if((0,n.l)(e[1]))p=e[1];else{if(!(0,n.n)(e[1]))throw new Error("Illegal Value: GroupBy");p=e[1].toArray()}let d=!1;for(const s of p)if((0,n.b)(s)){const t=D.WhereClause.create((0,n.h)(s),r.getFieldsIndex()),l=!0===(0,k.y5)(t)?(0,n.h)(s):"%%%%FIELDNAME";o.push({name:l,expression:t}),"%%%%FIELDNAME"===l&&(d=!0)}else{if(!(s instanceof M.Z))throw new Error("Illegal Value: GroupBy");{const t=s.hasField("name")?s.field("name"):"%%%%FIELDNAME",l=s.hasField("expression")?s.field("expression"):"";if("%%%%FIELDNAME"===t&&(d=!0),!t)throw new Error("Illegal Value: GroupBy");o.push({name:t,expression:D.WhereClause.create(l||t,r.getFieldsIndex())})}}if(d){const s={};for(const l of r.fields)s[l.name.toLowerCase()]=1;for(const l of o)"%%%%FIELDNAME"!==l.name&&(s[l.name.toLowerCase()]=1);let t=0;for(const l of o)if("%%%%FIELDNAME"===l.name){for(;1===s["field_"+t.toString()];)t++;s["field_"+t.toString()]=1,l.name="FIELD_"+t.toString()}}for(const s of o)yield B(s.expression,i,a);return e[0].groupby(o,[])}return function de(i,a,y,m){if(1===m.length){if((0,n.l)(m[0]))return(0,$.t)(i,m[0],-1);if((0,n.n)(m[0]))return(0,$.t)(i,m[0].toArray(),-1)}return(0,$.t)(i,m,-1)}("distinct",0,0,e)});return function(h,u,e){return m.apply(this,arguments)}}())})}}}]);