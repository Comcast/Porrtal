"use strict";(self.webpackChunka_porrtal_io_app=self.webpackChunka_porrtal_io_app||[]).push([[15],{80015:(w,E,r)=>{r.r(E),r.d(E,{default:()=>b});var n=r(17626),O=r(88879),D=r(63290),s=r(62208),p=r(32917),a=r(77712),f=(r(85931),r(90912),r(76898)),v=r(10410),P=r(98624),M=r(59990),d=r(96854),y=r(35560),F=r(14341),u=r(52836),A=r(19702),h=r(3493),j=r(2694),g=r(22498),c=r(52565),L=r(94443),R=r(72537),S=r(41941),C=r(42964),U=r(89476),W=r(67966),T=r(40465),x=r(57610),K=r(41632),B=r(78465),Q=r(87091);const I=(0,W.v)();let l=class extends((0,F.N)((0,U.l)((0,T.i)((0,A.A)(B.Z))))){constructor(){super(...arguments),this.type="scene-layer-3d",this.progressiveLoadFactor=1,this._elevationContext="scene",this._isIntegratedMesh=!1,this._supportsLabeling=!0,this._interactiveEditingSessions=new Map,this._queryEngine=null}get i3slayer(){return this.layer}get layerPopupEnabled(){return this.layer.popupEnabled}get filter(){return this._get("filter")}set filter(e){this._set("filter",g.z.checkSupport(e)?e:null)}get viewFilter(){const e=this.filter,t=this.layerFilter;if((0,s.Wi)(e)&&(0,s.Wi)(t))return null;const i=this._get("viewFilter");return(0,s.Wi)(i)?new g.z({layerFilter:t,viewFilter:e,layerFieldsIndex:this.layer.fieldsIndex,loadAsyncModule:_=>this._loadAsyncModule(_),addSqlFilter:(_,o)=>this.addSqlFilter(_,o,this.logError)}):(i.viewFilter=e,i.layerFilter=t,i)}get requiredFields(){return this._fieldsHelper?.requiredFields??[]}get _floorFilterClause(){const e=(0,M.c)(this);return(0,s.pC)(e)?v.WhereClause.create(e,this.layer.fieldsIndex):null}get _excludeObjectIdsSorted(){let e=this.layer.excludeObjectIds.toArray();return(0,y.Rx)()&&this.i3sOverrides.geometryChangedObjectIds.length>0&&(e=e.concat(this.i3sOverrides.geometryChangedObjectIds)),e.length?e.sort((t,i)=>t-i):null}get _objectQualitySettings(){return this.view?.qualitySettings?.sceneService?.object}get lodFactor(){return this._objectQualitySettings?.lodFactor??1}get lodCrossfadeinDuration(){return this._objectQualitySettings.lodCrossfadeinDuration??0}get lodCrossfadeoutDuration(){return this._objectQualitySettings.lodCrossfadeoutDuration??0}get lodCrossfadeUncoveredDuration(){return this._objectQualitySettings.lodCrossfadeUncoveredDuration??0}get updatingProgressValue(){return this._controller?.updatingProgress??0}initialize(){this._fieldsHelper=new x.K({layerView:this}),this.updatingHandles.add(()=>this.layer.rangeInfos,t=>this._rangeInfosChanged(t),p.nn),this.updatingHandles.add(()=>this.layer.renderer,t=>this.updatingHandles.addPromise(this._rendererChange(t)),p.nn);const e=()=>this._filterChange();this.updatingHandles.add(()=>this.parsedDefinitionExpression,e),this.updatingHandles.add(()=>this.filter,e),this.updatingHandles.add(()=>this._floorFilterClause,e),this.updatingHandles.add(()=>this._excludeObjectIdsSorted,e),this.updatingHandles.add(()=>(0,s.pC)(this.viewFilter)?this.viewFilter.sortedObjectIds:null,e),this.updatingHandles.add(()=>(0,s.pC)(this.viewFilter)?this.viewFilter.parsedWhereClause:null,e),this.updatingHandles.add(()=>[(0,s.pC)(this.viewFilter)?this.viewFilter.parsedGeometry:null,(0,s.pC)(this.filter)?this.filter.spatialRelationship:null,(0,s.pC)(this.layer.filter)?this.layer.filter.spatialRelationship:null],()=>this._geometryFilterChange()),this.handles.add(this.layer.on("apply-edits",t=>this.updatingHandles.addPromise(t.result))),this.handles.add(this.layer.on("edits",t=>this._handleEdits(t)))}destroy(){this._fieldsHelper=(0,s.SC)(this._fieldsHelper)}_rangeInfosChanged(e){null!=e&&e.length>0&&D.Z.getLogger(this.declaredClass).warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")}createQuery(){const e={outFields:["*"],returnGeometry:!1,outSpatialReference:this.view.spatialReference};return(0,s.pC)(this.filter)?this.filter.createQuery(e):new d.Z(e)}queryExtent(e,t){return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(e),t?.signal)}queryFeatureCount(e,t){return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(e),t?.signal)}queryFeatures(e,t){return this._ensureQueryEngine().executeQuery(this._ensureQuery(e),t?.signal).then(i=>{if(!i?.features)return i;const _=this.layer;for(const o of i.features)o.layer=_,o.sourceLayer=_;return i})}queryObjectIds(e,t){return this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(e),t?.signal)}_ensureQueryEngine(){return this._queryEngine||(this._queryEngine=this._createQueryEngine()),this._queryEngine}_createQueryEngine(){const e=(0,j.gz)(this.view.spatialReference,this.view.renderSpatialReference,this._collection);return new L.u({layerView:this,priority:Q.T8.FEATURE_QUERY_ENGINE,spatialIndex:new S.I({featureAdapter:new R.u({objectIdField:this.layer.objectIdField,attributeStorageInfo:this.layer.attributeStorageInfo,getFeatureExtent:e}),toArray:()=>{const t=new Array;return this._forAllFeatures((i,_,o)=>(t.push({id:i,index:_,meta:o}),u.K.CONTINUE),null,u.u.ALL_IN_CLIPPING_AREA),t},forAllFeatures:(t,i)=>this._forAllFeatures((_,o,m)=>t({id:_,index:o,meta:m}),i,u.u.ALL_IN_CLIPPING_AREA),getFeatureExtent:e,sourceSpatialReference:(0,C.tp)(this.layer),viewSpatialReference:this.view.spatialReference})})}highlight(e){const t=this._highlights;if(e instanceof d.Z){const{set:i,handle:_}=t.acquireSet();return this.queryObjectIds(e).then(o=>t.setFeatureIds(i,o)),_}return super.highlight(e)}createInteractiveEditSession(e){return(0,h.sw)(this._attributeEditingContext,e)}_createLayerGraphic(e){const t=new O.Z(null,null,e);return t.layer=this.layer,t.sourceLayer=this.layer,t}canResume(){return super.canResume()&&(!this._controller||this._controller.rootNodeVisible)}getFilters(){const e=super.getFilters(),t=this._excludeObjectIdsSorted;return(0,s.pC)(t)&&e.push(i=>(0,C.Yb)(t,!1,i)),this._floorFilterClause&&this.addSqlFilter(e,this._floorFilterClause,this.logError),this.addSqlFilter(e,this.parsedDefinitionExpression,this.logError),(0,s.pC)(this.viewFilter)&&this.viewFilter.addFilters(e,this.view,this._controller.crsIndex,this._collection),e}isUpdating(){return super.isUpdating()||this.layerFilterUpdating||(0,s.pC)(this.viewFilter)&&this.viewFilter.updating||(0,s.pC)(this.i3sOverrides)&&this.i3sOverrides.updating}_ensureQuery(e){return this._addDefinitionExpressionToQuery((0,s.Wi)(e)?this.createQuery():d.Z.from(e))}get _attributeEditingContext(){return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:this._getObjectIdField(),forEachNode:e=>this._forAllNodes(t=>(0,s.pC)(t)?e(t.node,t.featureIds):null),attributeStorageInfo:this.i3slayer.attributeStorageInfo,i3sOverrides:this.i3sOverrides,getAttributeData:e=>this.getAttributeData(e),setAttributeData:(e,t)=>this.setAttributeData(e,t),clearMemCache:()=>this.clearMemCache()}}_handleEdits(e){(0,y.Rx)()&&(0,h.ZS)(this._attributeEditingContext,e),(0,h.Z6)(this._attributeEditingContext,e)}get hasGeometryFilter(){const e=this.viewFilter;return(0,s.pC)(e)&&(0,s.pC)(e.parsedGeometry)}computeNodeFiltering(e){const t=this.viewFilter;return(0,s.Wi)(t)||t.isMBSGeometryVisible(e,this.view.spatialReference,this._controller.crsIndex)?c.U_.Unmodified:c.U_.Culled}};(0,n._)([(0,a.Cb)()],l.prototype,"i3slayer",null),(0,n._)([(0,a.Cb)(K.q)],l.prototype,"updatingProgress",void 0),(0,n._)([(0,a.Cb)({type:P.Z})],l.prototype,"filter",null),(0,n._)([(0,a.Cb)({readOnly:!0})],l.prototype,"viewFilter",null),(0,n._)([(0,a.Cb)(I.requiredFields)],l.prototype,"requiredFields",null),(0,n._)([(0,a.Cb)(I.availableFields)],l.prototype,"availableFields",void 0),(0,n._)([(0,a.Cb)()],l.prototype,"_fieldsHelper",void 0),(0,n._)([(0,a.Cb)()],l.prototype,"_floorFilterClause",null),(0,n._)([(0,a.Cb)()],l.prototype,"_excludeObjectIdsSorted",null),(0,n._)([(0,a.Cb)()],l.prototype,"_objectQualitySettings",null),(0,n._)([(0,a.Cb)()],l.prototype,"lodFactor",null),(0,n._)([(0,a.Cb)()],l.prototype,"updatingProgressValue",null),l=(0,n._)([(0,f.j)("esri.views.3d.layers.SceneLayerView3D")],l);const b=l}}]);