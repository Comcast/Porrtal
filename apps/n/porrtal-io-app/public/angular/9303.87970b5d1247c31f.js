"use strict";(self.webpackChunka_porrtal_io_app=self.webpackChunka_porrtal_io_app||[]).push([[9303],{30750:(Te,ie,l)=>{l.d(ie,{S:()=>U,b:()=>D});var g=l(2166),A=l(69960),d=l(65787),v=l(17625),le=l(22355),ee=l(16396);function D(F){const te=new le.kG;te.extensions.add("GL_OES_standard_derivatives");const{vertex:j,fragment:J,attributes:Z,varyings:z}=te;return(0,g.Sv)(j,F),Z.add(ee.T.POSITION,"vec3"),Z.add(ee.T.UV0,"vec2"),z.add("vUV","vec2"),j.code.add(v.H`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),J.uniforms.add([new A.N("backgroundColor",L=>L.backgroundColor),new A.N("gridColor",L=>L.gridColor),new d.p("gridWidth",L=>L.gridWidth)]),J.code.add(v.H`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
gl_FragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),te}const U=Object.freeze(Object.defineProperty({__proto__:null,build:D},Symbol.toStringTag,{value:"Module"}))},40405:(Te,ie,l)=>{l.d(ie,{B:()=>S});var g=l(15861),A=l(22558),d=l(21726),v=l(35948),le=l(34117),ee=l(31283),D=l(77712);function U(p){return j[function F(p){return p instanceof Blob?p.type:function te(p){const b=(0,d.Ml)(p);return z[b]||J}(p.url)}(p)]||Z}const j={},J="text/plain",Z=j[J],z={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const p in z)j[z[p]]=p;var L=l(29840);function S(p){const b=p?.origins??[void 0];return(s,m)=>{const I=function oe(p,b,s){if("resource"===p?.type)return function q(p,b,s){const m=(0,le.VZ)(b,s);return{type:String,read:(I,B,_)=>{const T=(0,L.r)(I,B,_);return m.type===String?T:"function"==typeof m.type?new m.type({url:T}):void 0},write:{writer(I,B,_,T){if(!T||!T.resources)return"string"==typeof I?void(B[_]=(0,L.t)(I,T)):void(B[_]=I.write({},T));const pe=function he(p){return null==p?null:"string"==typeof p?p:p.url}(I),h=(0,L.t)(pe,{...T,verifyItemRelativeUrls:T&&T.verifyItemRelativeUrls?{writtenUrls:T.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},L.M.NO),W=m.type!==String&&(!(0,A.l)(this)||T&&T.origin&&this.originIdOf(s)>(0,ee.M9)(T.origin)),ae={object:this,propertyName:s,value:I,targetUrl:h,dest:B,targetPropertyName:_,context:T,params:p};T&&T.portalItem&&h&&!(0,d.YP)(h)?W?function G(p){const{context:b,targetUrl:s,params:m,value:I,dest:B,targetPropertyName:_}=p;if(!b.portalItem)return;const T=b.portalItem.resourceFromPath(s),pe=We(I,s,b),h=U(pe),W=(0,d.Ml)(T.path),ae=m?.compress??!1;h===W?(b.resources&&_e({...p,resource:T,content:pe,compress:ae,updates:b.resources.toUpdate}),B[_]=s):Ve(p)}(ae):function y({context:p,targetUrl:b,dest:s,targetPropertyName:m}){p.portalItem&&p.resources&&(p.resources.toKeep.push({resource:p.portalItem.resourceFromPath(b),compress:!1}),s[m]=b)}(ae):T&&T.portalItem&&(null==h||null!=(0,L.i)(h)||(0,d.jc)(h)||W)?Ve(ae):B[_]=h}}}}(p,b,s);switch(p?.type??"other"){case"other":return{read:!0,write:!0};case"url":{const{read:m,write:I}=L.a;return{read:m,write:I}}}}(p,s,m);for(const B of b){const _=(0,D.CJ)(s,B,m);for(const T in I)_[T]=I[T]}}}function Ve(p){const{targetUrl:b,params:s,value:m,context:I,dest:B,targetPropertyName:_}=p;if(!I.portalItem)return;const T=(0,L.p)(b),pe=T?.filename??(0,v.D)(),h=s?.prefix??T?.prefix,W=We(m,b,I),ae=(0,d.v_)(h,pe),De=`${ae}.${U(W)}`,Me=I.portalItem.resourceFromPath(De);(0,d.jc)(b)&&I.resources&&I.resources.pendingOperations.push(function Ge(p){return ce.apply(this,arguments)}(b).then(Ze=>{Me.path=`${ae}.${U(Ze)}`,B[_]=Me.itemRelativeUrl}).catch(()=>{}));const Fe=s?.compress??!1;I.resources&&_e({...p,resource:Me,content:W,compress:Fe,updates:I.resources.toAdd}),B[_]=Me.itemRelativeUrl}function _e({object:p,propertyName:b,updates:s,resource:m,content:I,compress:B}){s.push({resource:m,content:I,compress:B,finish:_=>{!function O(p,b,s){"string"==typeof p[b]?p[b]=s.url:p[b].url=s.url}(p,b,_)}})}function We(p,b,s){return"string"==typeof p?{url:b}:new Blob([JSON.stringify(p.toJSON(s))],{type:"application/json"})}function ce(){return(ce=(0,g.Z)(function*(p){const b=(yield Promise.resolve().then(l.bind(l,84792))).default,{data:s}=yield b(p,{responseType:"blob"});return s})).apply(this,arguments)}},22558:(Te,ie,l)=>{function g(A){return A&&"getAtOrigin"in A&&"originOf"in A}l.d(ie,{l:()=>g})},60595:(Te,ie,l)=>{l.d(ie,{T:()=>le});var g=l(15861),A=l(84792),d=l(26584),v=l(62208);function le(D,U,F,te,j,J){return ee.apply(this,arguments)}function ee(){return(ee=(0,g.Z)(function*(D,U,F,te,j,J){let Z=null;if((0,v.pC)(F)){const S=`${D}/nodepages/`,oe=S+Math.floor(F.rootIndex/F.nodesPerPage);try{return{type:"page",rootPage:(yield(0,A.default)(oe,{query:{f:"json",token:te},responseType:"json",signal:J})).data,rootIndex:F.rootIndex,pageSize:F.nodesPerPage,lodMetric:F.lodSelectionMetricType,urlPrefix:S}}catch(q){(0,v.pC)(j)&&j.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",oe,q),Z=q}}if(!U)return null;const z=`${D}/nodes/`,L=z+(U&&U.split("/").pop());try{return{type:"node",rootNode:(yield(0,A.default)(L,{query:{f:"json",token:te},responseType:"json",signal:J})).data,urlPrefix:z}}catch(S){throw new d.Z("sceneservice:root-node-missing","Root node missing.",{pageError:Z,nodeError:S,url:L})}})).apply(this,arguments)}},47351:(Te,ie,l)=>{l.r(ie),l.d(ie,{default:()=>$i});var g=l(17626),A=l(14517),d=l(62208),v=l(77712),ee=(l(85931),l(90912)),D=l(76898),U=l(1437),te=(l(29132),l(79608)),j=l(23719),J=l(86810),Z=l(66656),z=l(40405),L=l(72642);let S=class extends((0,te.J)(J.wq)){constructor(e){super(e),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&(0,d._W)(this.position,e.position)&&this.width===e.width&&this.height===e.height}};(0,g._)([(0,v.Cb)({readOnly:!0,json:{read:!1,write:!0}})],S.prototype,"type",void 0),(0,g._)([(0,v.Cb)({type:L.Z}),(0,z.B)()],S.prototype,"position",void 0),(0,g._)([(0,v.Cb)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,z.B)(),(0,Z.p)(e=>j.BV.normalize((0,ee.q9)(e),0,!0))],S.prototype,"heading",void 0),(0,g._)([(0,v.Cb)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,z.B)(),(0,Z.p)(e=>j.BV.normalize((0,ee.q9)(e),0,!0))],S.prototype,"tilt",void 0),(0,g._)([(0,v.Cb)({type:Number,nonNullable:!0}),(0,z.B)()],S.prototype,"width",void 0),(0,g._)([(0,v.Cb)({type:Number,nonNullable:!0}),(0,z.B)()],S.prototype,"height",void 0),S=(0,g._)([(0,D.j)("esri.analysis.SlicePlane")],S);const oe=S;var q=l(72392),Ve=l(63290),G=l(32917),y=l(41743),_e=l(44917),We=l(49410),Ge=l(8314),ce=l(21286),he=l(23841),O=l(28347),p=l(43703),b=l(48977),s=l(84161),m=l(28093),I=l(55915),B=l(78172),_=l(90014),T=l(70562),pe=l(34054),h=l(26242),W=l(4794);const ae=(0,Ge.Z)("mac")?"Meta":"Control",De="Shift",At=Math.cos((0,ce.Vl)(45)),at=Math.cos((0,ce.Vl)(5)),Se=(0,m.f)(1,.5,0),we=(0,W.b)([...Se,.7]),Ce=[0,0,0,.04],rt=(0,W.b)([...Se,.5]),jt=(0,W.f)(1,1,1,1),Bt=(0,W.f)(1,.8,.6,1),zt=(0,W.f)(1,.93,.86,1),Gt=(0,W.b)([...Se,1]),Ft=(0,W.b)([...Se,1]),Yt=(0,W.b)([...Se,1]);var ht=l(54865),ut=l(45403),xe=l(19142),qt=l(87469),pt=l(993),ei=l(53928),ge=l(57521),se=l(40723),ti=l(13934),ii=l(87601),ai=l(60881),si=l(5894),gt=l(60909),ni=l(57623),ri=l(17625),li=l(651),oi=l(91056),di=l(39114),ci=l(12407),hi=l(30750),Oe=l(67969),Ye=l(2078);class ui extends ri.K{constructor(){super(...arguments),this.backgroundColor=(0,W.f)(1,0,0,.5),this.gridColor=(0,W.f)(0,1,0,.5),this.gridWidth=4}}class Le extends oi.A{initializeProgram(t){return new ci.$(t.rctx,Le.shader.get().build(this.configuration),di.i)}initializePipeline(){return(0,Ye.sm)({blending:(0,Ye.wK)(Oe.zi.ONE,Oe.zi.ONE,Oe.zi.ONE_MINUS_SRC_ALPHA,Oe.zi.ONE_MINUS_SRC_ALPHA),depthTest:{func:Oe.wb.LESS},colorWrite:Ye.BK})}}Le.shader=new li.J(hi.S,()=>l.e(5175).then(l.bind(l,15175)));class pi extends se.F5{constructor(t){super(t,new vi),this._configuration=new ii.m}intersect(t,i,a,n,o,c,u){return(0,ni.Bw)(t,i,n,o,c,void 0,u)}createBufferWriter(){return new gt.G_(gt.W1)}requiresSlot(t,i){return i===ti.H.Color&&t===si.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL}createGLMaterial(t){return new gi(t)}getConfiguration(){return this._configuration}}class gi extends ai.Z{constructor(t){super(t),this.ensureTechnique(Le,null)}beginSlot(){return(0,d.Wg)(this.technique)}}class vi extends ui{constructor(){super(...arguments),this.renderOccluded=se.yD.Occlude}}class yi extends ei._{constructor(t){super(t),this._material=null,this._renderOccluded=se.yD.OccludeAndTransparent,this._gridWidth=1,this._gridColor=(0,W.f)(1,0,0,1),this._backgroundColor=(0,W.f)(1,0,0,1),this.applyProps(t)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial())}get gridWidth(){return this._gridWidth}set gridWidth(t){this._gridWidth!==t&&(this._gridWidth=t,this._updateMaterial())}get gridColor(){return this._gridColor}set gridColor(t){(0,pt.c)(this._gridColor,t),this._updateMaterial()}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){(0,pt.c)(this._backgroundColor,t),this._updateMaterial()}createExternalResources(){this._material=new pi(this._materialParameters)}destroyExternalResources(){this._material=null}forEachExternalMaterial(t){(0,d.pC)(this._material)&&t(this._material)}createGeometries(t){if((0,d.pC)(this._material)){const i=(0,ge.g7)();t.addGeometry(i,this._material)}}get _materialParameters(){return{backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded}}_updateMaterial(){(0,d.pC)(this._material)&&this._material.setParameters(this._materialParameters)}}var ue,e,vt=l(13986),yt=l(26046),Ae=l(42743),Ue=l(92972),ft=l(49580),fi=l(92222),ne=l(33786);function mt(e,t){return(0,xe.Aq)(e.basis1,e.basis2,e.origin,t)}function Pt(e,t,i,a){const n=t.worldUpAtPosition(e.origin,h.WM.get()),o=h.WM.get();switch(i){case be.HEADING:(0,s.c)(o,n);break;case be.TILT:(0,s.c)(o,e.basis1)}return(0,_.Yq)(e.origin,o,a)}function Xe(e,t){switch(t){case ue.POSITIVE_X:return{basis:e.basis1,direction:1,position:(0,s.a)(h.WM.get(),e.origin,e.basis1),edge:t};case ue.POSITIVE_Y:return{basis:e.basis2,direction:1,position:(0,s.a)(h.WM.get(),e.origin,e.basis2),edge:t};case ue.NEGATIVE_X:return{basis:e.basis1,direction:-1,position:(0,s.b)(h.WM.get(),e.origin,e.basis1),edge:t};case ue.NEGATIVE_Y:return{basis:e.basis2,direction:-1,position:(0,s.b)(h.WM.get(),e.origin,e.basis2),edge:t}}}function Mt(e,t,i){const a=i.projectToRenderScreen((0,s.a)(h.WM.get(),e,t),(0,he.Wv)(h.WM.get())),n=i.projectToRenderScreen((0,s.b)(h.WM.get(),e,t),(0,he.Wv)(h.WM.get()));return(0,s.p)((0,s.b)(a,a,n))}function wt(e){const t=(0,s.l)(e.basis1),i=(0,s.l)(e.basis2);return.3*Math.min(t,i)}function ke(e){return wt(e)}function Qe(e){return 0!==e.direction[0]&&0!==e.direction[1]}function Ct(e,t){const i=(0,xe.Ju)(e,{customStateMask:K,texture:t});return i.state=K,i}function bt(e){return new qt.r({view:e,attached:!1,color:we,width:1,writeDepthEnabled:!1,renderOccluded:se.yD.OccludeAndTransparent,geometry:[[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]]]})}function Et(e){return new yi({view:e,attached:!1,backgroundColor:[...Ce],gridColor:rt,gridWidth:4,renderOccluded:se.yD.OccludeAndTransparent})}function Wi(e,t,i){const a=[];if((0,d.pC)(t))a.push([e,t.thickness/2],[-e,t.thickness/2],[-e,-t.thickness/2],[e,-t.thickness/2]);else for(let o=0;o<12;o++){const c=o/12*2*Math.PI;a.push([Math.cos(c)*e,Math.sin(c)*e])}return(0,ge.x2)(a,i,[],[],!1)}function Tt(e,t,i,a=new oe){if((0,d.Wi)(e))return null;const{renderCoordsHelper:n}=t,o=n.fromRenderCoords(e.origin,t.spatialReference);if((0,d.Wi)(o))return null;const c=(0,I.fM)(o,i);if((0,d.Wi)(c))return null;a.position=c;const u=2*(0,s.l)(e.basis1),f=2*(0,s.l)(e.basis2),E=vt.Z.renderUnitScaleFactor(t.spatialReference,i);a.width=u*E,a.height=f*E;const P=n.worldUpAtPosition(e.origin,h.WM.get());return a.tilt=(0,ce.BV)($e(e,P)),a.heading=n.headingAtPosition(e.origin,e.basis1)-90,a}function $e(e,t){return(0,pe.cp)(t,e.basis2,e.basis1)+Ee}l(2004),(e=ue||(ue={}))[e.POSITIVE_X=0]="POSITIVE_X",e[e.POSITIVE_Y=1]="POSITIVE_Y",e[e.NEGATIVE_X=2]="NEGATIVE_X",e[e.NEGATIVE_Y=3]="NEGATIVE_Y";const K=ne.jg.Custom1;var be,re;(function(e){e[e.HEADING=1]="HEADING",e[e.TILT=2]="TILT"})(be||(be={})),function(e){e[e.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL",e[e.VERTICAL=2]="VERTICAL",e[e.TILTED=3]="TILTED"}(re||(re={}));const Ne=ne.jg.Custom2,He=(0,T.Ue)(),Ee=Math.PI/2,Je=ne.jg.Custom1,Li=ne.jg.Custom2;var je;function Ai(e){return(0,d.pC)("building-scene-3d"===e.type?e:null)}!function(e){e[e.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",e[e.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"}(je||(je={}));var Ui=l(94573);const Dt="esri.views.3d.analysis.Slice.SliceController",qe=Ve.Z.getLogger(Dt);let fe=class extends A.Z{constructor(e){super(e),this._handles=new q.Z,this._internalChange=!1,this._currentSlicePlane=null}initialize(){this._handles.add(this.analysis.excludedLayers.on("before-add",e=>{const t=e.item;null!=t&&(t instanceof _e.Z||t instanceof We.Z)?t instanceof _e.Z&&function Ni(e){switch(e.type){case"building-scene":case"csv":case"dimension":case"feature":case"geo-rss":case"geojson":case"graphics":case"group":case"integrated-mesh":case"kml":case"line-of-sight":case"map-notes":case"ogc-feature":case"oriented-imagery":case"point-cloud":case"route":case"scene":case"stream":case"voxel":case"subtype-group":case"unknown":case"unsupported":case"wfs":case null:return!1;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"elevation":case"imagery":case"imagery-tile":case"map-image":case"media":case"open-street-map":case"tile":case"vector-tile":case"wcs":case"web-tile":case"wms":case"wmts":return!0;default:return(0,Ui.Bg)(e.type),!1}}(t)?(qe.error("excludedLayers",`Layer '${t.title}, id:${t.id}' of type '${t.type}' can not be individually excluded from slicing. Use 'excludeGroundSurface' instead.`),e.preventDefault()):this.analysis.excludedLayers.includes(t)&&e.preventDefault():(qe.error("excludedLayers","Invalid layer type, layer must derive from Layer or BuildingComponentSublayer"),e.preventDefault())})),function ji(e,t){me.has(e)||me.set(e,{all:[],activeController:null}),me.get(e).all.push(t)}(this.view,this),this._handles.add([(0,G.YP)(()=>this.analysisViewData.plane,()=>{this._internalChange||this._updateSlicePlaneFromBoundedPlane(),this._updateLayerViews()},{sync:!0}),(0,G.YP)(()=>this.analysis.excludeGroundSurface,()=>this._updateLayerViews(),{sync:!0}),this.analysis.excludedLayers.on("change",()=>this._updateLayerViews()),(0,G.YP)(()=>[this.analysisViewData.active,this.analysisViewData.visible],()=>{this._updateActiveController(),this._updateViewSlicePlane()},{sync:!0}),(0,G.YP)(()=>this._allLayerAndSubLayerViews,()=>this._updateLayerViews())]),this._handles.add([(0,G.YP)(()=>this.analysis.shape,()=>{this._internalChange||(this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane())},{sync:!0})],"analysis"),this._updateActiveController(),this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane()}destroy(){this.analysisViewData.active&&(this.analysisViewData.active=!1,this.view.slicePlane=null),function Bi(e,t){if(!me.has(e))throw new Error("view expected in global slice register");const i=me.get(e),a=i.all.lastIndexOf(t);if(-1===a)throw new Error("controller expected in global slice register");i.all.splice(a,1),0===i.all.length&&me.delete(e)}(this.view,this),this._handles.destroy(),this.set("view",null)}get _allLayerAndSubLayerViews(){const e=this.view.allLayerViews.items;return e.concat(e.filter(Ai).flatMap(({sublayerViews:t})=>t.items))}_updateBoundedPlaneFromSlicePlane(){const e=this.analysis.shape,t=this._currentSlicePlane;if((0,d.Wi)(t)&&(0,d.Wi)(e)||(0,d.pC)(t)&&(0,d.pC)(e)&&e.equals(t))return;let i=null,a=null;if((0,d.pC)(e)&&(0,d.pC)(e.position)){const n=e.position.spatialReference,o=function Vt(e,t){if((0,d.Wi)(e)||(0,d.Wi)(e.position))return null;const i=(0,ht.G)(e.position,t.spatialReference,t.elevationProvider);if((0,d.Wi)(i))return null;const a=vt.Z.renderUnitScaleFactor(e.position.spatialReference,t.spatialReference);return{position:i,heading:e.heading,tilt:e.tilt,renderWidth:e.width*a,renderHeight:e.height*a}}(e,this.view);(0,d.Wi)(o)&&(0,ht.e)(this.analysis,n,qe),i=function _t(e,t,i,a=(0,y.a)()){if((0,d.Wi)(e))return null;const n=function xi(e,t,i,a,n,o,c=(0,y.a)()){return o.toRenderCoords(e,c.origin)?(o.worldBasisAtPosition(c.origin,B.R.X,c.basis1),o.worldBasisAtPosition(c.origin,B.R.Y,c.basis2),(0,_.my)(c.basis2,c.basis1,c.origin,c.plane),(0,y.r)(c,-(0,ce.Vl)(t),(0,y.n)(c),c),(0,y.r)(c,(0,ce.Vl)(i),c.basis1,c),(0,s.g)(c.basis1,c.basis1,a/2),(0,s.g)(c.basis2,c.basis2,n/2),(0,y.u)(c),c):(Ve.Z.getLogger("esri.views.3d.analysis.Slice.sliceToolUtils").error(`Failed to project slice plane position, projection from ${e.spatialReference.wkid} is not supported`),null)}(e.position,e.heading,e.tilt,e.renderWidth,e.renderHeight,t.renderCoordsHelper,a);return!i.tiltEnabled&&(0,d.pC)(n)&&function Mi(e,t,i){const a=t.worldUpAtPosition(e.origin,h.WM.get()),n=e.basis1,o=$e(e,a),c=Math.round(o/Ee)*Ee;(0,y.r)(e,c-o,n,i)}(n,t.renderCoordsHelper,n),n}(o,this.view,{tiltEnabled:this.analysis.tiltEnabled},(0,y.a)()),(0,d.pC)(i)&&(a={heading:e.heading,tilt:e.tilt,position:e.position,width:e.width,height:e.height})}this._currentSlicePlane=a,this._internalChange=!0,this.analysisViewData.plane=i,this._internalChange=!1}_updateSlicePlaneFromBoundedPlane(){const t=Tt(this.analysisViewData.plane,this.view,this.view.spatialReference,new oe);let i=null;(0,d.pC)(t)&&(i={heading:t.heading,tilt:t.tilt,position:t.position,width:t.width,height:t.height}),this._currentSlicePlane=i,this._internalChange=!0,this.analysis.shape=t,this._internalChange=!1,this._updateViewSlicePlane()}_updateActiveController(){if(et)return;const e=St(this.view);if(this.analysisViewData.active)(0,d.pC)(e.activeController)&&e.activeController!==this?(et=!0,e.activeController.analysisViewData.active=!1,et=!1):(0,d.pC)(e.activeController),this._updateLayerViews(),e.activeController=this;else{if((0,d.pC)(e.activeController)&&e.activeController!==this)return;(0,d.pC)(e.activeController)&&e.activeController===this&&(e.activeController=null,this._updateLayerViews())}}_updateViewSlicePlane(){!function Hi(e){const t=St(e).activeController;e.slicePlane=(0,d.pC)(t)&&(0,d.pC)(t.analysisViewData.plane)&&t.analysisViewData.visible?t.analysisViewData.plane:null}(this.view)}_updateLayerViews(){const e=(0,d.pC)(this.analysisViewData.plane)&&this.analysisViewData.visible&&this.analysisViewData.active,t=[],i=a=>{"layers"in a?a.layers.forEach(i):t.push(a)};this.analysis.excludedLayers.forEach(i),this.view.allLayerViews.forEach(a=>{a.destroyed||("slicePlaneEnabled"in a&&(a.slicePlaneEnabled=e&&!t.includes(a.layer)),"sublayerViews"in a&&a.sublayerViews.forEach(n=>{n.slicePlaneEnabled=e&&!t.includes(n.sublayer)}))}),null!=this.view.basemapTerrain&&(this.view.basemapTerrain.slicePlaneEnabled=e&&!this.analysis.excludeGroundSurface)}};(0,g._)([(0,v.Cb)()],fe.prototype,"view",void 0),(0,g._)([(0,v.Cb)()],fe.prototype,"analysis",void 0),(0,g._)([(0,v.Cb)()],fe.prototype,"analysisViewData",void 0),(0,g._)([(0,v.Cb)()],fe.prototype,"_allLayerAndSubLayerViews",null),fe=(0,g._)([(0,D.j)(Dt)],fe);const me=new Map;let et=!1;function St(e){return me.get(e)}var tt,zi=l(84244),Gi=l(50618),Ot=l(25601),Be=l(8859),Fi=l(62483),Zi=l(67857),Ki=l(58997),ze=l(30260),Ie=l(41900);let Y=tt=class extends Ki.f{constructor(e){super(e),this._clock=zi.m,this._previewPlaneOpacity=1,this.removeIncompleteOnCancel=!1,this.layersMode="none",this.shiftManipulator=null,this.rotateHeadingManipulator=null,this.rotateTiltManipulator=null,this.resizeManipulators=null,this._handles=new q.Z,this._viewHandles=new q.Z,this._frameTask=null,this._pointerMoveTimerMs=2500,this._prevPointerMoveTimeout=null,this._previewPlaneGridVisualElement=null,this._previewPlaneOutlineVisualElement=null,this._startPlane=(0,y.a)(),this._previewPlane=null,this._activeKeyModifiers={},this._lastCursorPosition=(0,he.vW)(),this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._intersector=(0,Fi.Z8)(e.view.state.viewingMode),this._intersector.options.store=Zi.eC.MIN}initialize(){if(null==this.analysis)throw new Error("SliceTool requires valid analysis, but null was provided.");this._rotateHeadingImage=(0,Ot.O)(this.view.toolViewManager.textures),this._rotateTiltImage=(0,Ot.s)(this.view.toolViewManager.textures);const e=i=>{this._updateManipulatorsInteractive(i),i.grabbing||((0,d.pC)(this.analysisViewData.plane)&&(0,y.c)(this.analysisViewData.plane,this._startPlane),this.inputState=null)};this.shiftManipulator=function Si(e,t=je.CENTER_ON_ARROW){const i=t===je.CENTER_ON_CALLOUT?40:0,a=[(0,m.f)(i,0,-24),(0,m.f)(i,0,24)],n=function Ri(e,t){const i=(0,s.b)((0,m.c)(),e[e.length-1],e[e.length-2]);if((0,s.n)(i,i),(0,s.g)(i,i,22.5),(0,s.a)(i,i,e[e.length-1]),t){const a=(0,s.b)((0,m.c)(),e[0],e[1]);return(0,s.n)(a,a),(0,s.g)(a,a,22.5),(0,s.a)(a,a,e[0]),[a,...e,i]}return[...e,i]}(a,!0),o=(w,H)=>function Ii(e,t,i){const a=n=>{const o=(n?t:e).slice(0),c=(0,s.b)(h.WM.get(),o[0],o[1]);(0,s.n)(c,c);const u=(0,s.b)(h.WM.get(),o[o.length-1],o[o.length-2]);if((0,s.n)(u,u),i.padding>0){const $=(0,s.g)((0,m.c)(),u,-i.padding);if(o[o.length-1]=(0,s.a)($,$,o[o.length-1]),i.bothEnds){const ye=(0,s.g)((0,m.c)(),c,-i.padding);o[0]=(0,s.a)(ye,ye,o[0])}}const f=n?i.tipFocusMultiplier:1,E=i.tipLength*(i.focusTipLength?f:1),P=i.tipRadius*f,C=(0,O.i)(h.MP.get());if(i.padding>0){const $=E/4,ye=(0,s.s)(h.WM.get(),0,$,0),Pe=1+i.padding/$;(0,O.v)(C,C,ye),(0,O.k)(C,C,(0,s.s)(h.WM.get(),Pe,Pe,Pe)),(0,O.v)(C,C,(0,s.g)(ye,ye,-1/Pe))}const N=(0,O.i)((0,p.c)()),k=(0,m.f)(0,1,0),x=(0,O.D)((0,p.c)(),(0,b.r)(h.vD.get(),k,u));x[12]=o[o.length-1][0],x[13]=o[o.length-1][1],x[14]=o[o.length-1][2],(0,O.m)(x,x,C);const w=[{part:"tube",geometry:Wi(i.tubeRadius*(n?i.tubeFocusMultiplier:1)+i.padding,i.flat,o),transform:N}];let H,Q;if((0,d.pC)(i.flat)?H=(0,ge.DA)(E,P,P,i.flat.thickness):(H=(0,ge.QL)(E,P,24,!1,!1,!0),Q=(0,ge.QL)(E,P,24,!1,!0,!1)),w.push({part:"tip",geometry:H,transform:x}),Q&&w.push({part:"cap",geometry:Q,transform:x}),i.bothEnds){const $=(0,O.D)((0,p.c)(),(0,b.r)(h.vD.get(),k,c));$[12]=o[0][0],$[13]=o[0][1],$[14]=o[0][2],(0,O.m)($,$,C),w.push({part:"tip",geometry:H,transform:$}),Q&&w.push({part:"cap",geometry:Q,transform:$})}return w};return{normal:a(!1),focused:a(!0)}}(a,a,{tubeRadius:3,tipRadius:11,tipLength:22.5,tubeFocusMultiplier:1.15,tipFocusMultiplier:1.15,padding:w,bothEnds:!0,flat:null,focusTipLength:!0,addCap:H}),c=o(0,!1),u=o(2.25,!0),f=new Ue.E({color:jt,cullFace:Ae.Vr.Back,renderOccluded:se.yD.Opaque}),E=new Ue.E({color:Bt,cullFace:Ae.Vr.Back,renderOccluded:se.yD.Opaque}),P=new Ue.E({color:zt,cullFace:Ae.Vr.Back,renderOccluded:se.yD.Opaque}),C=new Ue.E({color:Ft,transparent:!0,writeDepth:!1,cullFace:Ae.Vr.Front,renderOccluded:se.yD.Transparent}),N=(0,ge.rh)([[i,0,0],[i-40,0,0]]),k=(0,ge.rh)([[i,0,0],[i-40,0,0]]),x=new ft.Y({color:Gt,renderOccluded:se.yD.OccludeAndTransparent});return new ut.Z({view:e,renderObjects:[...c.normal.map(({part:w,geometry:H,transform:Q})=>({geometry:H,material:"tip"===w?f:"cap"===w?E:P,transform:Q,stateMask:ne.Q9.Unfocused|K})),...u.normal.map(({geometry:w,transform:H})=>({geometry:w,material:C,transform:H,stateMask:ne.Q9.Unfocused|K})),{geometry:N,material:x,stateMask:ne.Q9.Unfocused|K|Ne},...c.focused.map(({part:w,geometry:H,transform:Q})=>({geometry:H,material:"tip"===w?f:"cap"===w?E:P,transform:Q,stateMask:ne.Q9.Focused|K})),...u.focused.map(({geometry:w,transform:H})=>({geometry:w,material:C,transform:H,stateMask:ne.Q9.Focused|K})),{geometry:k,material:x,stateMask:ne.Q9.Focused|K|Ne}],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[n]},collisionPriority:1,radius:11,state:K})}(this.view),this.manipulators.add(this.shiftManipulator),this.shiftManipulator.events.on("grab-changed",i=>{this._onShiftGrab(i),e(this.shiftManipulator)}),this._handles.add(this._createShiftDragPipeline(this.shiftManipulator)),this.rotateHeadingManipulator=Ct(this.view,this._rotateHeadingImage.texture),this.manipulators.add(this.rotateHeadingManipulator),this.rotateHeadingManipulator.events.on("grab-changed",i=>{this._onRotateHeadingGrab(i),e(this.rotateHeadingManipulator)}),this._handles.add(this._createRotateHeadingDragPipeline(this.rotateHeadingManipulator)),this.rotateTiltManipulator=Ct(this.view,this._rotateTiltImage.texture),this.manipulators.add(this.rotateTiltManipulator),this.rotateTiltManipulator.events.on("grab-changed",i=>{this._onRotateTiltGrab(i),e(this.rotateTiltManipulator)}),this._handles.add(this._createRotateTiltDragPipeline(this.rotateTiltManipulator)),this.resizeManipulators=this._resizeHandles.map((i,a)=>{const n=function Oi(e,t){const i=Qe(t),a=i?[(0,m.f)(1,0,0),(0,m.f)(0,0,0),(0,m.f)(0,1,0)]:[(0,m.f)(1,0,0),(0,m.f)(-1,0,0)],n=(0,ge.rh)(a),o=Yt,f=i?4:1,E=2*f,C=x=>x>1?(x=>new fi.U({color:o,width:x,renderOccluded:se.yD.OccludeAndTransparent}))(x):new ft.Y({color:o,renderOccluded:se.yD.OccludeAndTransparent}),N=[{geometry:n,material:C(f),stateMask:ne.Q9.Unfocused|Je},{geometry:n,material:C(E),stateMask:ne.Q9.Focused|Je},{geometry:n,material:C(1),stateMask:Li}],k=new ut.Z({view:e,renderObjects:N,collisionType:{type:"line",paths:[a]},radius:i?6:4,...xe.X9});return k.state=Je,k}(this.view,i);return n.events.on("grab-changed",o=>{this._onResizeGrab(o,a),e(n)}),this._handles.add(this._createResizeDragPipeline(n)),n}),this.manipulators.addMany(this.resizeManipulators),this._previewPlaneGridVisualElement=Et(this.view),this._previewPlaneOutlineVisualElement=bt(this.view),this._previewPlaneOutlineVisualElement.width=2,this._handles.add((0,G.YP)(()=>this.analysisViewData.plane,()=>this._updateManipulators(),G.Z_));const t=(0,G.YP)(()=>this.state,i=>{"sliced"===i&&this.finishToolCreation()},G.tX);this._handles.add([t,(0,G.YP)(()=>this.view.state.camera,()=>this._onCameraChange())])}destroy(){this._rotateHeadingImage=(0,d.RY)(this._rotateHeadingImage),this._rotateTiltImage=(0,d.RY)(this._rotateTiltImage),this._handles=(0,d.SC)(this._handles),this._viewHandles=(0,d.SC)(this._viewHandles),this._removeFrameTask(),this._clearPointerMoveTimeout(),this._previewPlaneOutlineVisualElement=(0,d.SC)(this._previewPlaneOutlineVisualElement),this._previewPlaneGridVisualElement=(0,d.SC)(this._previewPlaneGridVisualElement)}get state(){const e=!!this.analysisViewData.plane,t=!!this.inputState;return e?e&&t?"slicing":e&&!t?"sliced":"ready":"ready"}get cursor(){return this._isPlacingSlicePlane||"exclude"===this.layersMode?"crosshair":(0,d.pC)(this._creatingPointerId)?"grabbing":null}set analysis(e){if(null==e)throw new Error("SliceTool requires valid analysis, but null was provided.");this._handles.remove("analysis"),this._set("analysis",e)}get inputState(){return this._get("inputState")}set inputState(e){this._set("inputState",e),this.analysisViewData.showGrid=(0,d.pC)(e)&&"resize"===e.type,this._updateMaterials()}get _isPlacingSlicePlane(){return!this.inputState&&!this.analysisViewData.plane&&this.active}get _creatingPointerId(){return(0,d.pC)(this.inputState)&&"shift"===this.inputState.type?this.inputState.creatingPointerId:null}enterExcludeLayerMode(){(0,d.Wi)(this.analysisViewData.plane)||(this._set("layersMode","exclude"),this.active||(this.view.activeTool=this))}exitExcludeLayerMode(){(0,d.Wi)(this.analysisViewData.plane)||(this._set("layersMode","none"),this.active&&(this.view.activeTool=null))}onDeactivate(){this._set("layersMode","none"),this._updatePreviewPlane(null)}onShow(){this._updateVisibility(!0)}onHide(){this._updateVisibility(!1)}_updateVisibility(e){this._updateManipulators(),e||this._clearPointerMoveTimeout()}onInputEvent(e){switch(e.type){case"pointer-drag":if(!it(e))return;this._isPlacingSlicePlane?this._onClickPlacePlane(e)&&e.stopPropagation():this._onPointerDrag(e)&&e.stopPropagation();break;case"pointer-move":this._onPointerMove(e);break;case"pointer-up":this._onPointerUp(e)&&e.stopPropagation();break;case"immediate-click":if(!it(e))return;this._onClickPlacePlane(e)&&e.stopPropagation();break;case"click":if(!it(e))return;this._onClickExcludeLayer(e)&&e.stopPropagation();break;case"drag":this.inputState&&e.stopPropagation();break;case"key-down":this._onKeyDown(e)&&e.stopPropagation();break;case"key-up":this._onKeyUp(e)&&e.stopPropagation()}}onEditableChange(){this.analysisViewData.editable=this.internallyEditable}_onPointerDrag(e){const t=this.inputState;if(e.pointerId===this._creatingPointerId&&(0,d.pC)(t)&&"shift"===t.type){const i=(0,Ie.vT)(e);return this.shiftManipulator.events.emit("drag",{action:t.hasBeenDragged?"update":"start",pointerType:e.pointerType,start:i,screenPoint:i}),t.hasBeenDragged=!0,!0}return!1}_onPointerMove(e){this._lastCursorPosition.x=e.x,this._lastCursorPosition.y=e.y,this._resetPointerMoveTimeout(),"touch"!==e.pointerType&&this._updatePreviewPlane((0,Ie.vT)(e),this._activeKeyModifiers)}_onCameraChange(){this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),this._updateManipulators()}_onPointerUp(e){if(e.pointerId===this._creatingPointerId&&(0,d.pC)(this.analysisViewData.plane)){const t=(0,Ie.vT)(e);return this.shiftManipulator.events.emit("drag",{action:"end",start:t,screenPoint:t}),(0,y.c)(this.analysisViewData.plane,this._startPlane),this.inputState=null,!0}return!1}_onClickPlacePlane(e){if("exclude"===this.layersMode)return!1;if(this._isPlacingSlicePlane){const t=(0,Ie.vT)(e),i=(0,y.a)();if(this._pickPlane(t,!1,this._activeKeyModifiers,i)){if((0,y.c)(i,this._startPlane),this.analysis.shape=Tt(i,this.view,this.view.spatialReference,new oe),"pointer-drag"===e.type){const a=this._calculatePickRay(t);this.inputState=It(a,e.pointerId,i.origin,i)}return!0}}return!1}_onClickExcludeLayer(e){return!("exclude"!==this.layersMode||!this.created||(this.view.hitTest((0,Ie.vT)(e)).then(t=>{if(t.results.length){const i=t.results[0],a="graphic"===i?.type&&i.graphic;if(a){const n=a.sourceLayer||a.layer;n&&this.analysis.excludedLayers.push(n)}}else t.ground.layer?this.analysis.excludedLayers.push(t.ground.layer):this.analysis.excludeGroundSurface=!0}),this._set("layersMode","none"),this.active&&(this.view.activeTool=null),0))}_onKeyDown(e){return(e.key===De||e.key===ae)&&(this._activeKeyModifiers[e.key]=!0,(0,d.pC)(this._previewPlane)&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),!0)}_onKeyUp(e){return!(e.key!==De&&e.key!==ae||!this._activeKeyModifiers[e.key]||(delete this._activeKeyModifiers[e.key],(0,d.pC)(this._previewPlane)&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),0))}_onShiftGrab(e){if("start"!==e.action||(0,d.Wi)(this.analysisViewData.plane))return;const t=this._calculatePickRay(e.screenPoint);(0,y.c)(this.analysisViewData.plane,this._startPlane),this.inputState=It(t,null,this.shiftManipulator.renderLocation,this.analysisViewData.plane)}_createShiftDragPipeline(e){return(0,ze.Xd)(e,(t,i,a)=>{const n=this.inputState;if((0,d.Wi)(n)||"shift"!==n.type)return;const o=(0,d.pC)(this.analysisViewData.plane)?(0,y.c)(this.analysisViewData.plane,(0,y.a)()):null;i.next((0,Be._N)(this.view,n.shiftPlane)).next(this._shiftDragAdjustSensitivity(n)).next(this._shiftDragUpdatePlane(n)),a.next(()=>{(0,d.pC)(o)&&this._updateBoundedPlane(o)})})}_shiftDragAdjustSensitivity(e){return t=>{if((0,d.Wi)(this.analysisViewData.plane))return null;const a=Math.min((1-Math.abs((0,s.e)((0,y.n)(this.analysisViewData.plane),t.ray.direction)/(0,s.l)(t.ray.direction)))/.001,1),n=-(0,_.jH)(this._startPlane.plane,t.renderEnd),o=-(0,_.jH)(this._startPlane.plane,e.startPoint);return e.depth=e.depth*(1-a)+n*a-o,t}}_shiftDragUpdatePlane(e){return()=>{if((0,d.Wi)(this.analysisViewData.plane))return;const t=(0,s.c)(h.WM.get(),this._startPlane.origin),i=(0,s.c)(h.WM.get(),(0,y.n)(this._startPlane));(0,s.g)(i,i,-e.depth),(0,s.a)(i,i,t);const a=(0,y.f)(i,this.analysisViewData.plane.basis1,this.analysisViewData.plane.basis2,(0,y.a)());this._updateBoundedPlane(a)}}_onRotateHeadingGrab(e){if("start"!==e.action||(0,d.Wi)(this.analysisViewData.plane))return;const t=Pt(this.analysisViewData.plane,this.view.renderCoordsHelper,be.HEADING,(0,_.Ue)()),i=this._calculatePickRay(e.screenPoint),a=(0,m.c)();(0,_.BR)(t,i,a)&&((0,y.c)(this.analysisViewData.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:t,startPoint:a})}_createRotateHeadingDragPipeline(e){return(0,ze.Xd)(e,(t,i,a)=>{const n=this.inputState;if((0,d.Wi)(n)||"rotate"!==n.type)return;const o=(0,d.pC)(this.analysisViewData.plane)?(0,y.c)(this.analysisViewData.plane,(0,y.a)()):null;i.next((0,Be._N)(this.view,n.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(n)).next(this._rotateDragUpdatePlaneFromRotate()),a.next(()=>{(0,d.pC)(o)&&this._updateBoundedPlane(o)})})}_onRotateTiltGrab(e){if("start"!==e.action||(0,d.Wi)(this.analysisViewData.plane))return;const t=Pt(this.analysisViewData.plane,this.view.renderCoordsHelper,be.TILT,(0,_.Ue)()),i=this._calculatePickRay(e.screenPoint),a=(0,m.c)();(0,_.BR)(t,i,a)&&((0,y.c)(this.analysisViewData.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:t,startPoint:a})}_createRotateTiltDragPipeline(e){return(0,ze.Xd)(e,(t,i,a)=>{const n=this.inputState;if((0,d.Wi)(n)||"rotate"!==n.type)return;const o=(0,d.pC)(this.analysisViewData.plane)?(0,y.c)(this.analysisViewData.plane,(0,y.a)()):null;i.next((0,Be._N)(this.view,n.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(n)).next(this._rotateDragUpdatePlaneFromRotate()),a.next(()=>{(0,d.pC)(o)&&this._updateBoundedPlane(o)})})}_rotateDragRenderPlaneToRotate(e){return t=>{if((0,d.Wi)(this.analysisViewData.plane))return null;const i=(0,_.mJ)(e.rotatePlane),a=(0,xe.Gd)(e.startPoint,t.renderEnd,this.analysisViewData.plane.origin,i);return{...t,rotateAxis:i,rotateAngle:a}}}_rotateDragUpdatePlaneFromRotate(){return e=>{if((0,d.Wi)(this.analysisViewData.plane))return;const t=(0,O.d)(h.MP.get(),e.rotateAngle,e.rotateAxis);if((0,d.Wi)(t))return;const i=(0,s.m)(h.WM.get(),this._startPlane.basis1,t),a=(0,s.m)(h.WM.get(),this._startPlane.basis2,t),n=(0,y.f)(this.analysisViewData.plane.origin,i,a,(0,y.a)());this._updateBoundedPlane(n)}}_onResizeGrab(e,t){if("start"!==e.action||(0,d.Wi)(this.analysisViewData.plane))return;const i=this._calculatePickRay(e.screenPoint),a=h.WM.get();(0,_.BR)(this.analysisViewData.plane.plane,i,a)&&((0,y.c)(this.analysisViewData.plane,this._startPlane),this.inputState={type:"resize",activeHandleIdx:t,startPoint:(0,m.a)(a)})}_createResizeDragPipeline(e){return(0,ze.Xd)(e,(t,i,a)=>{const n=this.inputState;if((0,d.Wi)(n)||"resize"!==n.type||(0,d.Wi)(this.analysisViewData.plane))return;const o=(0,y.c)(this.analysisViewData.plane,(0,y.a)());i.next((0,Be._N)(this.view,this.analysisViewData.plane.plane)).next(this._resizeDragUpdatePlane(n)),a.next(()=>{this._updateBoundedPlane(o)})})}_resizeDragUpdatePlane(e){return t=>{if((0,d.Wi)(this.analysisViewData.plane))return;const a=function wi(e,t,i,a,n,o){const c=(0,s.c)(h.WM.get(),n.origin);(0,s.a)(c,c,(0,s.g)(h.WM.get(),n.basis1,e.direction[0]<0?1:-1)),(0,s.a)(c,c,(0,s.g)(h.WM.get(),n.basis2,e.direction[1]<0?1:-1));const u=(0,s.l)(n.basis1),f=(0,s.l)(n.basis2),E=(0,s.b)(h.WM.get(),i,c),P=(0,s.b)(h.WM.get(),t,c);let C=0,N=0;if(Qe(e)){const $=ke(n),ye=ke(o);C=u-.5*e.direction[0]*(0,s.e)(n.basis1,P)/u,N=f-.5*e.direction[1]*(0,s.e)(n.basis2,P)/f;const Pe=ye/$;C*=Pe,N*=Pe}const k=C+.5*e.direction[0]*(0,s.e)(n.basis1,E)/u,x=N+.5*e.direction[1]*(0,s.e)(n.basis2,E)/f,w=(0,s.g)(h.WM.get(),n.basis1,k/u),H=(0,s.g)(h.WM.get(),n.basis2,x/f);(k<=0||Mt(o.origin,w,a)<=1600)&&(0,s.c)(w,o.basis1),(x<=0||Mt(o.origin,H,a)<=1600)&&(0,s.c)(H,o.basis2);const Q=(0,s.c)(h.WM.get(),c);return(0,s.a)(Q,Q,(0,s.g)(h.WM.get(),w,e.direction[0]<0?-1:1)),(0,s.a)(Q,Q,(0,s.g)(h.WM.get(),H,e.direction[1]<0?-1:1)),(0,y.f)(Q,w,H,o)}(this._resizeHandles[e.activeHandleIdx],e.startPoint,t.renderEnd,this.view.state.camera,this._startPlane,(0,y.c)(this.analysisViewData.plane));this._updateBoundedPlane(a)}}_updateBoundedPlane(e){const t=this.analysisViewData;if(!(0,d.pC)(t))throw new Error("valid internal object expected");t.plane=e}_updatePreviewPlane(e,t={}){let i=this._previewPlane;if(this._previewPlane=null,(0,d.Wi)(e))return this._removeFrameTask(),void this._updateManipulators();if(!this.analysisViewData.plane&&this.active){const a=(0,d.pC)(i)?i:(0,y.a)();if(i=(0,d.pC)(i)?(0,y.c)(i,Yi):null,this._pickPlane(e,!0,t,a)){const n=.95;let o=!1;(0,d.pC)(i)&&(o=(0,s.e)(i.plane,a.plane)<n||(0,s.e)((0,s.n)(h.WM.get(),i.basis1),(0,s.n)(h.WM.get(),a.basis1))<n),o&&(this._previewPlaneOpacity=0),this._previewPlane=a}}(0,d.pC)(this._previewPlane)&&(0,d.Wi)(this._frameTask)&&0===this._previewPlaneOpacity?this._frameTask=(0,Gi.A)({update:({deltaTime:a})=>{this._previewPlaneOpacity=Math.min(this._previewPlaneOpacity+a/300,1),this._updateManipulators(),1===this._previewPlaneOpacity&&this._removeFrameTask()}}):(0,d.Wi)(this._previewPlane)&&(0,d.pC)(this._frameTask)?this._removeFrameTask():(0,d.pC)(this._previewPlane)&&this._updateManipulators()}_removeFrameTask(){this._frameTask=(0,d.hw)(this._frameTask)}_calculatePickRay(e){const t=(0,T.Ue)(),i=(0,he.md)(e,Xi);return(0,yt.u4)(this.view.state.camera,i,t),(0,s.n)(t.direction,t.direction),t}_pickMinResult(e){const t=(0,he.md)(e,h.qW.get());return this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector),this._intersector.results.min}_pickPlane(e,t,i,a){const n=this._pickMinResult(e),o=h.WM.get();if(!n.getIntersectionPoint(o))return!1;const c=n.getTransformedNormal(h.WM.get()),u=this.view.state.camera;(0,s.e)(c,u.viewForward)>0&&(0,s.g)(c,c,-1);const f=function Ci(e,t){return.4*Math.min(t.width,t.height)*t.computeRenderPixelSizeAt(e)}(o,u),E=(t?1:-1)*f*.02,P=(0,s.g)(h.WM.get(),c,E);return(0,s.a)(P,P,o),function mi(e,t,i,a,n,o,c,u){return function Pi(e,t,i,a,n,o){const c=(0,s.e)(e,t),u=h.WM.get(),f=h.WM.get();switch(a===re.HORIZONTAL_OR_VERTICAL?Math.abs(c)>At?re.HORIZONTAL:re.VERTICAL:a){case re.VERTICAL:{const P=Math.abs(c)<=at?e:i.viewUp;(0,s.f)(u,P,t),(0,s.c)(f,t);break}case re.HORIZONTAL:(0,s.f)(u,i.viewUp,t),(0,s.f)(f,t,u);break;case re.TILTED:{const P=Math.abs(c)<=at?t:i.viewUp;(0,s.f)(u,P,e),(0,s.f)(f,e,u);break}}const E=(0,s.f)(h.WM.get(),u,f);(0,s.e)(E,i.viewForward)>0&&(0,s.g)(f,f,-1),(0,s.n)(n,u),(0,s.n)(o,f)}(t,c.worldUpAtPosition(e,h.WM.get()),n,o,u.basis1,u.basis2),(0,s.g)(u.basis1,u.basis1,i),(0,s.g)(u.basis2,u.basis2,a),(0,s.c)(u.origin,e),(0,_.my)(u.basis2,u.basis1,u.origin,u.plane),u}(P,c,f,f,u,i[De]?re.VERTICAL:i[ae]?re.HORIZONTAL:this.analysis.tiltEnabled?re.TILTED:re.HORIZONTAL_OR_VERTICAL,this.view.renderCoordsHelper,a),!0}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=(0,d.hw)(this._prevPointerMoveTimeout)}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.shiftManipulator.state|=K,this.rotateHeadingManipulator.state|=K,this.rotateTiltManipulator.state|=K,this._prevPointerMoveTimeout=this._clock.setTimeout(()=>{this.shiftManipulator.state&=~K,this.rotateHeadingManipulator.state&=~K,this.rotateTiltManipulator.state&=~K},this._pointerMoveTimerMs)}_updateManipulators(){if(tt.disableEngineLayers)return;let e=null,t=!1;if((0,d.pC)(this.analysisViewData.plane))e=this.analysisViewData.plane,t=!1;else{if(!(0,d.pC)(this._previewPlane))return this.shiftManipulator.available=!1,this.rotateHeadingManipulator.available=!1,this.rotateTiltManipulator.available=!1,this.resizeManipulators.forEach(c=>c.available=!1),this._previewPlaneOutlineVisualElement.visible=!1,void(this._previewPlaneGridVisualElement.visible=!1);e=this._previewPlane,t=!0}const i=mt(e,h.MP.get());t?(this.shiftManipulator.available=!1,this.rotateHeadingManipulator.available=!1,this.rotateTiltManipulator.available=!1,this.resizeManipulators.forEach(c=>c.available=!1),this._previewPlaneOutlineVisualElement.attached=!0,this._previewPlaneGridVisualElement.attached=!0,this._previewPlaneOutlineVisualElement.visible=!0,this._previewPlaneGridVisualElement.visible=!0):(this.shiftManipulator.available=!0,this.rotateHeadingManipulator.available=!0,this.rotateTiltManipulator.available=this.analysis.tiltEnabled,this.resizeManipulators.forEach(c=>c.available=!0),function Ei(e,t,i,a){const n=Xe(i,ue.NEGATIVE_X),o=h.MP.get();(0,O.o)(o,t,n.edge*Math.PI/2);const c=(0,s.n)(h.WM.get(),n.basis);let u=(0,s.g)(h.WM.get(),c,n.direction*a.computeScreenPixelSizeAt(n.position)*40);(0,s.a)(u,u,n.position);const f=a.projectToRenderScreen(u,(0,he.Wv)(h.WM.get())),E=function Ti(e,t){const[i,a,n,o]=e.viewport,c=Math.min(n,o)/16;let u=!0;return t[0]<i+c?(t[0]=i+c,u=!1):t[0]>i+n-c&&(t[0]=i+n-c,u=!1),t[1]<a+c?(t[1]=a+c,u=!1):t[1]>a+o-c&&(t[1]=a+o-c,u=!1),u}(a,f);(0,yt.Bh)(a,f,He),(0,s.n)(He.direction,He.direction);const P=h.WM.get();!E&&(0,y.i)(i,He,P)&&(u=P),o[12]=0,o[13]=0,o[14]=0,e.modelTransform=o,e.renderLocation=(0,m.a)(u),E?e.state|=Ne:e.state&=~Ne}(this.shiftManipulator,i,e,this.view.state.camera),function _i(e,t,i,a){const n=a.worldUpAtPosition(i.origin,h.WM.get()),o=Xe(i,ue.POSITIVE_X),c=(0,O.b)(h.MP.get(),o.edge*Math.PI/2);(0,O.r)(c,c,-$e(i,n)),(0,O.m)(c,t,c),c[12]=0,c[13]=0,c[14]=0,e.modelTransform=c,e.renderLocation=o.position}(this.rotateHeadingManipulator,i,e,this.view.renderCoordsHelper),function Di(e,t,i){const a=Xe(i,ue.POSITIVE_Y),n=(0,O.b)(h.MP.get(),a.edge*Math.PI/2);(0,O.r)(n,n,Ee),(0,O.m)(n,t,n),n[12]=0,n[13]=0,n[14]=0,e.modelTransform=n,e.renderLocation=a.position}(this.rotateTiltManipulator,i,e),this.resizeManipulators.forEach((c,u)=>function Vi(e,t,i,a){const n=(0,s.l)(a.basis1),o=(0,s.l)(a.basis2),c=wt(a),u=ke(a),f=(0,s.s)(h.WM.get(),0,0,0);(0,s.a)(f,(0,s.g)(h.WM.get(),a.basis1,t.direction[0]),(0,s.g)(h.WM.get(),a.basis2,t.direction[1])),(0,s.a)(f,a.origin,f);let E=0,P=1;if(Qe(t))1===t.direction[0]&&-1===t.direction[1]?E=Ee:1===t.direction[0]&&1===t.direction[1]?E=Math.PI:-1===t.direction[0]&&1===t.direction[1]&&(E=3*Math.PI/2),P=u;else{const N=0!==t.direction[0]?1:2;E=1===N?Ee:0,P=(1===N?o:n)-c}const C=(0,O.b)(h.MP.get(),E);(0,O.k)(C,C,(0,s.s)(h.WM.get(),P,P,P)),(0,O.m)(C,i,C),C[12]=0,C[13]=0,C[14]=0,e.modelTransform=C,e.renderLocation=f}(c,this._resizeHandles[u],i,e)),this._previewPlaneOutlineVisualElement.visible=!1,this._previewPlaneGridVisualElement.visible=!1);const a=(0,s.s)(h.WM.get(),(0,s.l)(e.basis1),(0,s.l)(e.basis2),1),n=(0,O.C)(h.MP.get(),a),o=(0,O.m)(n,i,n);this._previewPlaneOutlineVisualElement.transform=o,this._previewPlaneGridVisualElement.transform=o,this._updateMaterials()}_updateMaterials(){this._previewPlaneOutlineVisualElement.color=[we[0],we[1],we[2],we[3]*this._previewPlaneOpacity],this._previewPlaneGridVisualElement.backgroundColor=[Ce[0],Ce[1],Ce[2],Ce[3]*this._previewPlaneOpacity],this._previewPlaneGridVisualElement.gridColor=[0,0,0,0]}_updateManipulatorsInteractive(e){if(!e.grabbing)return this.shiftManipulator.interactive=!0,this.rotateHeadingManipulator.interactive=!0,this.rotateTiltManipulator.interactive=!0,void this.resizeManipulators.forEach(t=>{t.interactive=!0});this.shiftManipulator.interactive=this.shiftManipulator===e,this.rotateHeadingManipulator.interactive=this.rotateHeadingManipulator===e,this.rotateTiltManipulator.interactive=this.rotateTiltManipulator===e,this.resizeManipulators.forEach(t=>{t.interactive=t===e})}testData(){return{plane:this.analysisViewData.plane,setPointerMoveTimerMs:e=>{this._pointerMoveTimerMs=e}}}};function It(e,t,i,a){const n=function bi(e,t,i,a){const n=(0,s.f)(h.WM.get(),t,i);return(0,s.f)(n,n,t),(0,_.Yq)(e,n,a)}(i,(0,y.n)(a),e.direction,(0,_.Ue)()),o=(0,m.c)();return(0,_.BR)(n,e,o)?{type:"shift",creatingPointerId:t,hasBeenDragged:!1,shiftPlane:n,depth:0,startPoint:o}:null}function it(e){return"mouse"!==e.pointerType||0===e.button}Y.disableEngineLayers=!1,(0,g._)([(0,v.Cb)()],Y.prototype,"_clock",void 0),(0,g._)([(0,v.Cb)({constructOnly:!0})],Y.prototype,"view",void 0),(0,g._)([(0,v.Cb)()],Y.prototype,"analysisViewData",void 0),(0,g._)([(0,v.Cb)({readOnly:!0})],Y.prototype,"state",null),(0,g._)([(0,v.Cb)({readOnly:!0})],Y.prototype,"cursor",null),(0,g._)([(0,v.Cb)()],Y.prototype,"analysis",null),(0,g._)([(0,v.Cb)()],Y.prototype,"removeIncompleteOnCancel",void 0),(0,g._)([(0,v.Cb)({readOnly:!0})],Y.prototype,"layersMode",void 0),(0,g._)([(0,v.Cb)({value:null})],Y.prototype,"inputState",null),(0,g._)([(0,v.Cb)()],Y.prototype,"_isPlacingSlicePlane",null),(0,g._)([(0,v.Cb)()],Y.prototype,"_creatingPointerId",null),Y=tt=(0,g._)([(0,D.j)("esri.views.3d.analysis.Slice.SliceTool")],Y);const Yi=(0,y.a)(),Xi=(0,he.s1)(),ki=Y;var Qi=l(54889);let ve=class extends A.Z{constructor(e){super(e),this._handles=new q.Z,this._gridVisualElement=null,this._outlineVisualElement=null,this.showGrid=!1,this.preview=!0}initialize(){const e=this.analysisViewData;if((0,d.Wi)(e))throw new Error("expected internal object to be valid");this._gridVisualElement=Et(this.view),this._outlineVisualElement=bt(this.view),this._handles.add([(0,G.YP)(()=>({visible:(0,d.pC)(e.plane)&&this.analysisViewData.visible,active:this.analysisViewData.active,preview:this.preview,showGrid:this.showGrid}),t=>this._updateMaterials(t),G.tX),(0,G.YP)(()=>e.plane,t=>this._updatePlane(t),G.tX)],"internal")}destroy(){this._handles.destroy(),this._gridVisualElement=(0,d.SC)(this._gridVisualElement),this._outlineVisualElement=(0,d.SC)(this._outlineVisualElement),this.set("view",null)}_updatePlane(e){if((0,d.Wi)(e))return;this._gridVisualElement.attached=!0,this._outlineVisualElement.attached=!0;const t=(0,s.s)(h.WM.get(),(0,s.l)(e.basis1),(0,s.l)(e.basis2),1),i=(0,O.C)(h.MP.get(),t),a=mt(e,h.MP.get()),n=(0,O.m)(i,a,i);this._outlineVisualElement.transform=n,this._gridVisualElement.transform=n}_updateMaterials({visible:e,active:t,preview:i,showGrid:a}){this._outlineVisualElement.color=we,this._outlineVisualElement.width=i?2:1,this._outlineVisualElement.stipplePattern=t?null:(0,Qi.z5)(5),this._gridVisualElement.backgroundColor=Ce,this._gridVisualElement.gridColor=a?rt:W.Z,this._gridVisualElement.visible=e,this._outlineVisualElement.visible=e}};(0,g._)([(0,v.Cb)()],ve.prototype,"view",void 0),(0,g._)([(0,v.Cb)()],ve.prototype,"analysis",void 0),(0,g._)([(0,v.Cb)()],ve.prototype,"analysisViewData",void 0),(0,g._)([(0,v.Cb)()],ve.prototype,"showGrid",void 0),(0,g._)([(0,v.Cb)()],ve.prototype,"preview",void 0),ve=(0,g._)([(0,D.j)("esri.views.3d.analysis.Slice.SliceVisualization")],ve);var Wt=l(95925);let de=class extends((0,U.p)(A.Z)){constructor(e){super(e),this.type="slice-view-3d",this.analysis=null,this.tool=null,this.analysisVisualization=null,this.analysisController=null,this.plane=null,this.active=!0}initialize(){this.analysisVisualization=new ve({view:this.view,analysis:this.analysis,analysisViewData:this}),this.analysisController=new fe({view:this.view,analysis:this.analysis,analysisViewData:this}),this.addHandles((0,Wt.Lp)(this,ki))}destroy(){(0,Wt.Yq)(this),this.analysisVisualization=(0,d.SC)(this.analysisVisualization),this.analysisController=(0,d.SC)(this.analysisController)}get showGrid(){return this.analysisVisualization?.showGrid??!1}set showGrid(e){this.analysisVisualization&&(this.analysisVisualization.showGrid=e)}get editable(){return!this.analysisVisualization.preview}set editable(e){this.analysisVisualization.preview=!e}get testData(){return{visualization:this.analysisVisualization,controller:this.analysisController,tool:(0,d.Wg)(this.tool)}}};(0,g._)([(0,v.Cb)({readOnly:!0})],de.prototype,"type",void 0),(0,g._)([(0,v.Cb)({constructOnly:!0,nonNullable:!0})],de.prototype,"analysis",void 0),(0,g._)([(0,v.Cb)()],de.prototype,"tool",void 0),(0,g._)([(0,v.Cb)()],de.prototype,"plane",void 0),(0,g._)([(0,v.Cb)()],de.prototype,"active",void 0),(0,g._)([(0,v.Cb)()],de.prototype,"showGrid",null),(0,g._)([(0,v.Cb)()],de.prototype,"editable",null),de=(0,g._)([(0,D.j)("esri.views.3d.analysis.SliceAnalysisView3D")],de);const $i=de},10023:(Te,ie,l)=>{l.d(ie,{V:()=>ee,e:()=>v});var g=l(15861),A=l(62208),d=l(36630);function v(D){return le.apply(this,arguments)}function le(){return(le=(0,g.Z)(function*(D,U=D.popupTemplate){if((0,A.Wi)(U))return[];const F=yield U.getRequiredFields(D.fieldsIndex),{lastEditInfoEnabled:te}=U,{objectIdField:j,typeIdField:J,globalIdField:Z,relationships:z}=D;if(F.includes("*"))return["*"];const L=te?yield(0,d.CH)(D):[],S=(0,d.Q0)(D.fieldsIndex,[...F,...L]);return J&&S.push(J),S&&j&&D.fieldsIndex.has(j)&&!S.includes(j)&&S.push(j),S&&Z&&D.fieldsIndex.has(Z)&&!S.includes(Z)&&S.push(Z),z&&z.forEach(oe=>{const{keyField:q}=oe;S&&q&&D.fieldsIndex.has(q)&&!S.includes(q)&&S.push(q)}),S})).apply(this,arguments)}function ee(D,U){return D.popupTemplate?D.popupTemplate:(0,A.pC)(U)&&U.defaultPopupTemplateEnabled&&(0,A.pC)(D.defaultPopupTemplate)?D.defaultPopupTemplate:null}}}]);